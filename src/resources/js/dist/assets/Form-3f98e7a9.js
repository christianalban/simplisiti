var de=Object.defineProperty;var pe=(e,o,n)=>o in e?de(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var O=(e,o,n)=>(pe(e,typeof o!="symbol"?o+"":o,n),n);import{i as Z,v as q,b as me,g as ve,c as be}from"./helpers-73a2380c.js";import{d as L,e as y,f as E,r as V,o as u,c as f,h as t,y as k,I as ge,a as p,j as D,t as v,v as x,l as w,J as fe,_ as P,k as M,w as T,n as I,g as N,F as j,i as he,p as _e,m as ye,K as $e,L as G,z as J}from"./index-fa07b5a0.js";import{D as A}from"./vuedraggable.umd-bac659bd.js";import{g as Ce}from"./ComponentService-6efc63db.js";import{_ as ke}from"./Group.vue_vue_type_script_setup_true_lang-f048d5e6.js";import{a as we,u as Se,b as Te}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-63125c67.js";import{u as ee}from"./ResourceService-63ff442d.js";import{b as Ie,e as K}from"./PageService-7235891c.js";const Ve=["onMousedown"],Le=L({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const o=e,n=y(500),s=y(Z()),r=E(()=>`position-${o.position}-0`),d=E(()=>{switch(o.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),l=a=>{const c=a.clientX,b=n.value,_=B=>{const R=o.position==="left"?b+(B.clientX-c):b-(B.clientX-c);n.value=R<200?200:R},U=()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",U)};window.addEventListener("mousemove",_),window.addEventListener("mouseup",U)},i=E(()=>s.value?"100%":o.canResize&&!o.isInvisible?`${n.value}px`:`${["left","right"].includes(o.position)?"initial":"100%"}`);return(a,c)=>{const b=V("fa-icon");return u(),f("div",{style:fe({width:i.value}),class:k(["float-toolbar",d.value,r.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[ge(a.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:k(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":["top","bottom"].includes(e.position),"float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right",bottom:e.position==="bottom",top:e.position==="top"}])},[t("button",{class:k(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:c[0]||(c[0]=_=>a.$emit("update:isInvisible",!e.isInvisible))},[p(b,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),D(" "+v(e.isInvisible?e.showLabel||a.$t("buttons.show"):e.hiddeLabel||a.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(u(),f("div",{key:0,class:"border-l-2 border-l-gray-200 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:x(l,["prevent","stop"])},null,40,Ve)):w("",!0)],6)}}});const te=P(Le,[["__scopeId","data-v-a5e17105"]]),Ue={class:"toolbar-container"},ze={class:"toolbar-actions"},Me={class:"flex gap-2"},De={type:"submit",class:"button primary"},Fe={class:"title"},Ee=["href"],Pe={class:"toolbar-route"},Be={class:"toolbar-route-input"},Re={class:"label"},Oe=["value","placeholder"],Ae={class:"toolbar-route-input"},Ne={class:"label"},je=["value","placeholder"],He={class:"toolbar-route-input"},We={class:"label"},Xe=["value","placeholder"],qe=L({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const o=y(!0);return(n,s)=>{const r=V("fa-icon"),d=V("router-link");return u(),M(te,{isInvisible:o.value,"onUpdate:isInvisible":s[4]||(s[4]=l=>o.value=l),showLabel:n.$t("pages.buttons.settings")},{default:T(()=>[t("div",Ue,[t("div",ze,[t("div",Me,[p(d,{class:"button secondary",to:{name:"pages.index"}},{default:T(()=>[p(r,{icon:"arrow-left"}),D(" "+v(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(u(),f("button",{key:0,onClick:s[0]||(s[0]=l=>n.$emit("delete")),type:"button",class:"button danger"},v(n.$t("buttons.delete")),1)):w("",!0),t("button",De,v(n.$t("buttons.save")),1)]),t("h1",Fe,[D(v(e.title)+" ",1),e.showDelete?(u(),f("a",{key:0,href:e.url,target:"_blank"},[p(r,{icon:"external-link-alt"})],8,Ee)):w("",!0)])]),t("div",Pe,[t("div",Be,[t("label",Re,v(n.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:s[1]||(s[1]=l=>n.$emit("update:name",I(q)(l.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,Oe)]),t("div",Ae,[t("label",Ne,v(n.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:s[2]||(s[2]=l=>n.$emit("update:pageTitle",I(me)(l.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,je)]),t("div",He,[t("label",We,v(n.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:s[3]||(s[3]=l=>n.$emit("update:url",I(q)(l.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,Xe)])])])]),_:1},8,["isInvisible","showLabel"])}}});const At=P(qe,[["__scopeId","data-v-6a5b1085"]]),Ge={class:"overflow-y-auto mt-2"},Je={class:"tile h-24 cursor-pointer"},Ke={class:"tile-title cursor-grab active:cursor-grabbing"},Qe=L({__name:"AvailableComponents",setup(e){const o=y([]),n=E(()=>ve(o.value)),s=y(!1),r=l=>{const i={};l.variables.forEach(c=>{i[c.name]=null});const a={id:l.id||1+1,...l,variables:l.variables.map(c=>({...c})),content:i};return delete a.content_id,a},d=()=>{s.value=!0,Ce({withData:!0}).then(l=>{o.value=l.data.data}).finally(()=>{s.value=!1})};return N(()=>{d()}),(l,i)=>{const a=V("fa-icon");return u(),f(j,null,[t("button",{onClick:d,type:"button",class:"button secondary"},[p(a,{icon:"sync",class:k({"animate-spin":s.value})},null,8,["class"]),D(" "+v(l.$t("components.buttons.refresh")),1)]),t("div",Ge,[p(ke,{items:n.value},{default:T(c=>[p(I(A),{class:"grid grid-cols-2 gap-4",modelValue:c.item,"onUpdate:modelValue":b=>c.item=b,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:r,"item-key":"id"},{item:T(({element:b})=>[t("div",Je,[t("label",Ke,v(I(be)(b.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])])],64)}}}),{resourceFromId:Ye}=ee(),Q=e=>typeof e=="string"?e==null?void 0:e.toString():"",Ze=e=>(typeof e=="number"||typeof e=="string")&&Ye(+e).url||"",xe=e=>{if(typeof e!="number"||typeof e!="string"){const o=e;return o.rows.reduce((n,s)=>{const r=o.columns.reduce((d,l)=>{const i=s.find(b=>b.name===l.name),a=(i==null?void 0:i.value)||(i==null?void 0:i.default),c=!(i!=null&&i.type)||!a?null:oe(i==null?void 0:i.type,a);return d[l.name]=c,d},{});return[...n,r]},[])}return[]},oe=(e,o)=>{switch(e){case"text":return Q(o);case"resource":return Ze(o);case"datatable":return xe(o);case"textarea":return Q(o);default:return""}},ne=(e,o)=>e.variables.reduce((s,r)=>{var i;const d=o&&o[r.name]?o[r.name]:(i=e.variables.find(a=>a.name===r.name))==null?void 0:i.default,l=d?oe(r.type,d):"";return s[r.name]=l,s},{});class et{constructor(){O(this,"component");O(this,"subscribedComponents",{})}subscribe(o,n){o.id&&(this.subscribedComponents[o.id]=n)}attach(o){this.component=o}detach(){this.component=void 0}update(){var o,n,s;this.component&&this.component.id&&((s=(n=this.subscribedComponents)[this.component.id])==null||s.call(n,ne(this.component,(o=this.component)==null?void 0:o.content)||{}))}}const tt=new et,H=()=>tt,ot={key:0,class:"component-configuration-parameters"},nt={class:"component-configuration-label"},st=L({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:o}){const n=H(),s=(d,l)=>{d.content&&(d.content[l]=null)},r=()=>{n.update()};return(d,l)=>{const i=V("fa-icon");return e.component?(u(),f("div",ot,[(u(!0),f(j,null,he(e.component.variables,a=>(u(),f("div",{key:a.name},[t("div",nt,[t("label",null,v(a.name)+":",1),p(i,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:c=>s(e.component,a.name)},null,8,["onClick"])]),e.component.content?(u(),M(we,{key:0,editStructure:!1,modelValue:e.component.content[a.name],"onUpdate:modelValue":[c=>e.component.content[a.name]=c,r],"default-value":a.default,name:a.name,type:a.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):w("",!0)]))),128))])):w("",!0)}}});const it=P(st,[["__scopeId","data-v-8aa60c2a"]]),at=e=>(_e("data-v-e8ede51d"),e=e(),ye(),e),lt=at(()=>t("hr",null,null,-1)),ct=L({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(o,n)=>{const s=V("fa-icon");return u(),f("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=x(r=>o.$emit("click"),["stop"])),type:"button"},[lt,t("span",null,[p(s,{icon:"square-plus"}),D(" "+v(o.$t("pages.buttons.addSection")),1)])])}}});const Y=P(ct,[["__scopeId","data-v-e8ede51d"]]),rt={class:"relative"},ut=t("div",{class:"absolute inset-0"},null,-1),dt=L({__name:"ComponentPreview",props:{component:{type:Object,required:!0}},setup(e){const o=H(),n=e,s=y(null),r=async i=>{if(!n.component.id)return;const a=await Ie(n.component.id,i);if(s.value){const c=s.value.contentDocument;if(!c)return;const[b,_]=l();c.open(),c.write(a.data),c.head.appendChild(b),c.body.appendChild(_),c.close(),s.value.onload=()=>{const U=c.body.scrollHeight;s.value&&(s.value.style.height=`${U}px`)}}},d=()=>{if(s.value){const i=s.value.contentDocument;if(!i)return;const a=i.body.offsetHeight;s.value.style.height=`${a}px`}},l=()=>{const i=document.createElement("link"),a=document.createElement("script"),c=K("style"),b=K("script");return i.rel="stylesheet",i.href=c,a.src=b,a.async=!0,[i,a]};return N(()=>{r(ne(n.component,n.component.content)),o.subscribe(n.component,i=>{r(i).then(()=>d())})}),(i,a)=>(u(),f("div",rt,[t("iframe",{class:"w-screen",ref_key:"iframe",ref:s,sandbox:"allow-scripts allow-same-origin"},null,512),ut]))}}),pt={class:"w-full p-4 flex flex-col overflow-y-auto h-[60vh] md:h-full"},mt={class:"form-group"},vt={class:"page-sections-container"},bt={class:"page-sections-content"},gt={class:"page-sections-item-panel"},ft={class:"page-sections-preview"},ht={class:"page-sections-preview-content"},_t={class:"page-sections-item-buttons"},yt={class:"page-sections-components-grip-lines"},$t={class:"pages-secttions-component-buttons"},Ct=["onClick"],kt=["onClick"],wt={class:"page-sections-label"},St={class:"hideable-header"},Tt={class:"page-sections-buttons"},It={key:1},Vt={key:2},Lt=["onClick"],Ut=L({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:1,components:[]}]},pageEditionMode:{type:String,default:"adding-component"}},emits:["update:sections"],setup(e,{emit:o}){const{loadResources:n}=ee(),{loadSources:s}=Se(),{loadActions:r}=Te(),d=H(),l=e,i=y(!0),a=o,c=y(null),b=y(null),_=y("adding-component"),U=m=>{const g=[...l.sections];g.splice(m,0,G({order:0,components:[]})),a("update:sections",g)},B=()=>{a("update:sections",[...l.sections,G({order:0,components:[]})])},R=m=>{const g=[...l.sections];g.splice(m,1),a("update:sections",g)},se=(m,g)=>{m.splice(g,1)},ie=(m,g)=>{i.value=!1,_.value="editing-component",c.value=m,b.value=g,d.attach(m)},ae=()=>{i.value=!0,_.value="adding-component",d.detach(),c.value=null,b.value=null},le=(m,g)=>{var $,F;return(($=c.value)==null?void 0:$.id)===m.id&&m.order===((F=c.value)==null?void 0:F.order)&&b.value===g},W=y(Z()),z=y(W.value?"bottom":"left"),ce=()=>{z.value=z.value==="left"?"right":"left"},re=E(()=>_.value==="adding-component"?"availableComponents":"componentConfigurationForm");return N(()=>{n(),s(),r()}),(m,g)=>{const $=V("fa-icon"),F=$e("autosize");return u(),f(j,null,[p(te,{isInvisible:i.value,"onUpdate:isInvisible":g[1]||(g[1]=C=>i.value=C),position:z.value,showLabel:m.$t(_.value==="editing-component"?"pages.buttons.settings":"pages.buttons.components"),canResize:!0},{default:T(()=>[t("div",pt,[t("div",{class:k(`component-configuration-title ${z.value}`)},[t("h2",null,v(m.$t(`pages.titles.${re.value}`)),1),t("div",null,[t("div",mt,[t("button",{type:"button",class:"button small default",onClick:ae},v(m.$t("pages.buttons.exit")),1),W.value?w("",!0):(u(),f("button",{key:0,type:"button",class:"button small default button-position",onClick:ce},[p($,{icon:"border-top-left"})]))])])],2),_.value==="adding-component"?(u(),M(Qe,{key:0})):w("",!0),_.value==="editing-component"?(u(),M(it,{key:1,position:z.value,"onUpdate:position":g[0]||(g[0]=C=>z.value=C),component:c.value},null,8,["position","component"])):w("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",vt,[t("div",bt,[p(I(A),{list:e.sections,class:"page-sections-panel",onInput:g[2]||(g[2]=C=>m.$emit("update:sections",C)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:T(({element:C,index:h})=>[t("div",{class:k(["page-sections-list-content",{"page-sections-list-header":!h,"page-sections-list-footer":h===e.sections.length-1}])},[h?(u(),M(Y,{key:0,onClick:S=>U(h)},null,8,["onClick"])):w("",!0),t("div",gt,[p(I(A),{class:"page-sections-dreaggable",modelValue:C.components,"onUpdate:modelValue":S=>C.components=S,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:T(({element:S,index:X})=>[t("div",{class:k(["page-sections-item",{"page-sections-item-selected":le(S,h)}])},[J((u(),f("div",ft,[J((u(),f("div",ht,[p(dt,{component:S},null,8,["component"])])),[[F]]),t("div",_t,[t("button",yt,[p($,{icon:"grip"})]),t("div",$t,[t("button",{type:"button",onClick:ue=>se(C.components,X)},[p($,{icon:"trash"})],8,Ct),t("button",{type:"button",onClick:ue=>ie(S,h)},[p($,{icon:"file-invoice"})],8,kt),t("span",wt,v(m.$t("pages.labels.component"))+" "+v((S.order=X)+1)+" - "+v(S.name),1)])])])),[[F]])],2)]),header:T(()=>[t("div",St,[p($,{icon:"triangle-exclamation"}),t("p",null,v(m.$t("pages.labels.addComponentsToSection",{section:h})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("div",Tt,[h&&h!==e.sections.length-1?(u(),M($,{key:0,icon:"grip",class:"page-sections-grip-lines"})):w("",!0),h?(u(),f("span",Vt,v(m.$t(h===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:C.order=h})),1)):(u(),f("span",It,[p($,{icon:"heading"}),D(" "+v(m.$t("pages.labels.header")),1)])),t("button",{onClick:S=>R(h)},[p($,{icon:"trash"})],8,Lt)])])],2)]),_:1},8,["list"]),p(Y,{onClick:B})])])],64)}}});const Nt=P(Ut,[["__scopeId","data-v-bb269b3b"]]);export{At as P,Nt as a};
