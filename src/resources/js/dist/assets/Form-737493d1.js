import{v as G,i as ne,g as se,c as ae}from"./helpers-ddca868d.js";import{d as I,e as P,r as D,o as u,c as f,g as t,D as C,E as ie,a as m,i as R,t as p,_ as B,b as k,j as V,w,k as S,l as T,f as j,F as X,h as le,n as ce,G as re,H as ue,A as de,I as pe,J,q as x}from"./index-e9e65b8b.js";import{D as q}from"./vuedraggable.umd-cd760cc7.js";import{g as me,b as ge}from"./ComponentService-aa18f521.js";import{_ as ve}from"./Group.vue_vue_type_script_setup_true_lang-ddc83a79.js";import{b as be,u as fe}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-c23828c6.js";import{u as Y}from"./ResourceService-d46d38fa.js";import{b as K}from"./PageService-10387b71.js";const he=I({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String}},emits:["update:isInvisible"],setup(e){const a=e,n=P(()=>`position-${a.position}-0`),s=P(()=>{switch(a.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}});return(l,c)=>{const o=D("fa-icon");return u(),f("div",{class:C(["float-toolbar",s.value,n.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:C(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:C(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:C(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[ie(l.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:C(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":e.position==="top","float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right"}])},[t("button",{class:C(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:c[0]||(c[0]=r=>l.$emit("update:isInvisible",!e.isInvisible))},[m(o,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),R(" "+p(e.isInvisible?e.showLabel||l.$t("buttons.show"):e.hiddeLabel||l.$t("buttons.hide")),1)],2)],2)],2)],2)}}});const Z=B(he,[["__scopeId","data-v-f23dbdce"]]),_e={class:"toolbar-container"},ye={class:"toolbar-actions"},$e={type:"submit",class:"button-link"},Ce={class:"title"},ke=["href"],we={class:"toolbar-route"},Se={class:"toolbar-route-input"},Ve={class:"label"},Te=["value","placeholder"],Ie={class:"toolbar-route-input"},Fe={class:"label"},De=["value","placeholder"],Ue={class:"toolbar-route-input"},Ee={class:"label"},Re=["value","placeholder"],Be=I({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const a=k(!0);return(n,s)=>{const l=D("fa-icon"),c=D("router-link");return u(),V(Z,{isInvisible:a.value,"onUpdate:isInvisible":s[4]||(s[4]=o=>a.value=o),showLabel:n.$t("pages.buttons.settings")},{default:w(()=>[t("div",_e,[t("div",ye,[m(c,{class:"button-link",to:{name:"pages.index"}},{default:w(()=>[m(l,{icon:"arrow-left"}),R(" "+p(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(u(),f("button",{key:0,onClick:s[0]||(s[0]=o=>n.$emit("delete")),type:"button",class:"button-link danger"},p(n.$t("buttons.delete")),1)):S("",!0),t("button",$e,p(n.$t("buttons.save")),1),t("h1",Ce,[R(p(e.title)+" ",1),e.showDelete?(u(),f("a",{key:0,href:e.url,target:"_blank"},[m(l,{icon:"external-link-alt"})],8,ke)):S("",!0)])]),t("div",we,[t("div",Se,[t("label",Ve,p(n.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:s[1]||(s[1]=o=>n.$emit("update:name",T(G)(o.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,Te)]),t("div",Ie,[t("label",Fe,p(n.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:s[2]||(s[2]=o=>n.$emit("update:pageTitle",T(ne)(o.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,De)]),t("div",Ue,[t("label",Ee,p(n.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:s[3]||(s[3]=o=>n.$emit("update:url",T(G)(o.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,Re)])])])]),_:1},8,["isInvisible","showLabel"])}}});const St=B(Be,[["__scopeId","data-v-e5b92884"]]),Le={class:"tile h-24 cursor-pointer"},Pe={class:"tile-title cursor-grab active:cursor-grabbing"},Ae=I({__name:"AvailableComponents",setup(e){const a=k([]),n=P(()=>se(a.value)),s=l=>{const c={};l.variables.forEach(r=>{c[r.name]=null});const o={id:l.id||1+1,...l,variables:l.variables.map(r=>({...r})),content:c};return delete o.content_id,o};return j(()=>{me({withData:!0}).then(l=>{a.value=l.data.data})}),(l,c)=>(u(),V(ve,{items:n.value},{default:w(o=>[m(T(q),{class:"grid grid-cols-2 gap-4",modelValue:o.item,"onUpdate:modelValue":r=>o.item=r,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:s,"item-key":"id"},{item:w(({element:r})=>[t("div",Le,[t("label",Pe,p(T(ae)(r.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"]))}}),Ne={key:0,class:"component-configuration-parameters"},Me={class:"component-configuration-label"},ze=I({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:a}){const n=(s,l)=>{s.content&&(s.content[l]=null)};return(s,l)=>{const c=D("fa-icon");return e.component?(u(),f("div",Ne,[(u(!0),f(X,null,le(e.component.variables,o=>(u(),f("div",{key:o.name},[t("div",Me,[t("label",null,p(o.name)+":",1),m(c,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:r=>n(e.component,o.name)},null,8,["onClick"])]),e.component.content?(u(),V(be,{key:0,modelValue:e.component.content[o.name],"onUpdate:modelValue":r=>e.component.content[o.name]=r,"default-value":o.default,name:o.name,type:o.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)}}});const Oe=B(ze,[["__scopeId","data-v-f55df8de"]]),He=e=>(re("data-v-e8ede51d"),e=e(),ue(),e),qe=He(()=>t("hr",null,null,-1)),We=I({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(a,n)=>{const s=D("fa-icon");return u(),f("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=ce(l=>a.$emit("click"),["stop"])),type:"button"},[qe,t("span",null,[m(s,{icon:"square-plus"}),R(" "+p(a.$t("pages.buttons.addSection")),1)])])}}});const Q=B(We,[["__scopeId","data-v-e8ede51d"]]),{resourceFromId:je}=Y(),W=e=>typeof e=="string"?e:"",Ge=e=>(typeof e=="number"||typeof e=="string")&&je(+e).url||"",Je=(e,a)=>{switch(e){case"text":return W(a);case"resource":return Ge(a);case"datatable":return a;case"textarea":return W(a);default:return""}},xe=(e,a,n)=>e.replace(`{{ $${a.name} }}`,W(n)),Ke=(e,a,n)=>[...e.matchAll(new RegExp(`<x-simplisiti::list-render.*${a.name}.*?</x-simplisiti::list-render>`,"gs"))].reduce((l,c)=>{const o=c[0],r=o?o.replace(new RegExp(/<x-simplisiti::list-render.*items.*>/,"m"),"").replace(new RegExp(/<\/x-simplisiti::list-render>/,"m"),""):"",$=[...r.matchAll(new RegExp(/\@{[{!]+\$dt->(.*.)(!!|})+}/g))],U=(n||a.value).reduce((A,N)=>A+$.reduce((M,L)=>{const z=L[1],O=L[0];return M.replaceAll(O,N[z])},r),"");return l.replace(o,U)},e),Qe=(e,a,n)=>{let s=e;return s=xe(s,a,n),s=Ke(s,a,n),s},Xe=I({__name:"SectionPreview",props:{content:{type:String,default:""}},setup(e){const a=e,n=k(null),s=c=>{if(n.value){const o=n.value.contentDocument;if(!o)return;const[r,$]=l();o.open(),o.write(c),o.head.appendChild(r),o.body.appendChild($),o.close(),n.value.onload=()=>{const y=o.body.firstChild,U=y==null?void 0:y.clientHeight;n.value&&(n.value.style.height=`${U}px`)}}},l=()=>{const c=document.createElement("link"),o=document.createElement("script"),r=K("style"),$=K("script");return c.rel="stylesheet",c.href=r,o.src=$,o.async=!0,[c,o]};return de(()=>a.content,c=>{s(c)}),j(()=>{s(a.content)}),(c,o)=>(u(),f("iframe",{class:"w-screen",ref_key:"iframe",ref:n,sandbox:"allow-scripts allow-same-origin"},null,512))}}),Ye={class:"w-[30vw] p-4 h-screen flex flex-col overflow-y-auto"},Ze={class:"form-group"},et={class:"page-sections-container"},tt={class:"page-sections-content"},ot={class:"page-sections-item-panel"},nt={class:"page-sections-preview"},st={class:"page-sections-preview-content"},at={class:"page-sections-item-buttons"},it={class:"page-sections-components-grip-lines"},lt={class:"pages-secttions-component-buttons"},ct=["onClick"],rt=["onClick"],ut={class:"page-sections-label"},dt={class:"hideable-header"},pt={class:"page-sections-buttons"},mt={key:1},gt={key:2},vt=["onClick"],bt=I({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:0,components:[]}]}},emits:["update:sections"],setup(e,{emit:a}){const{loadResources:n}=Y(),{loadSources:s}=fe(),l=e,c=k(!0),o=a,r=k(null),$=k(null),y=k("adding-component"),U=i=>{const d=[...l.sections];d.splice(i,0,J({order:0,components:[]})),o("update:sections",d)},A=()=>{o("update:sections",[...l.sections,J({order:0,components:[]})])},N=i=>{const d=[...l.sections];d.splice(i,1),o("update:sections",d)},M=(i,d)=>{i.splice(d,1)},L=(i,d)=>{c.value=!1,y.value="editing-component",r.value=i,$.value=d},z=()=>{c.value=!0,y.value="adding-component",r.value=null,$.value=null},O=i=>(i.content=i.content||ge(i),i.variables.reduce((h,_)=>{var E;const v=i.content&&i.content[_.name]?i.content[_.name]:(E=i.variables.find(H=>H.name===_.name))==null?void 0:E.default,g=v?Je(_.type,v==null?void 0:v.toString()):"";let b="";return typeof g=="string"?b=g:b=JSON.stringify(g),Qe(h,_,b||"")},i.html)),ee=(i,d)=>{var h,_;return((h=r.value)==null?void 0:h.id)===i.id&&i.order===((_=r.value)==null?void 0:_.order)&&$.value===d},F=k("left"),te=()=>{F.value=F.value==="left"?"right":"left"},oe=P(()=>y.value==="adding-component"?"availableComponents":"componentConfigurationForm");return j(()=>{n(),s()}),(i,d)=>{const h=D("fa-icon"),_=pe("autosize");return u(),f(X,null,[m(Z,{isInvisible:c.value,"onUpdate:isInvisible":d[1]||(d[1]=v=>c.value=v),position:F.value,showLabel:i.$t("pages.buttons.components")},{default:w(()=>[t("div",Ye,[t("div",{class:C(`component-configuration-title ${F.value}`)},[t("h2",null,p(i.$t(`pages.titles.${oe.value}`)),1),t("div",null,[t("div",Ze,[t("button",{type:"button",class:"button small default",onClick:z},p(i.$t("pages.buttons.exit")),1),t("button",{type:"button",class:"button small default button-position",onClick:te},[m(h,{icon:"border-top-left"})])])])],2),y.value==="adding-component"?(u(),V(Ae,{key:0})):S("",!0),y.value==="editing-component"?(u(),V(Oe,{key:1,position:F.value,"onUpdate:position":d[0]||(d[0]=v=>F.value=v),component:r.value},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",et,[t("div",tt,[m(T(q),{list:e.sections,class:"page-sections-panel",onInput:d[2]||(d[2]=v=>i.$emit("update:sections",v)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:w(({element:v,index:g})=>[t("div",{class:C(["page-sections-list-content",{"page-sections-list-header":!g,"page-sections-list-footer":g===e.sections.length-1}])},[g?(u(),V(Q,{key:0,onClick:b=>U(g)},null,8,["onClick"])):S("",!0),t("div",ot,[m(T(q),{class:"page-sections-dreaggable",modelValue:v.components,"onUpdate:modelValue":b=>v.components=b,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:w(({element:b,index:E})=>[t("div",{class:C(["page-sections-item",{"page-sections-item-selected":ee(b,g)}])},[x((u(),f("div",nt,[x((u(),f("div",st,[m(Xe,{content:O(b)},null,8,["content"])])),[[_]]),t("div",at,[t("button",it,[m(h,{icon:"grip"})]),t("div",lt,[t("button",{type:"button",onClick:H=>M(v.components,E)},[m(h,{icon:"trash"})],8,ct),t("button",{type:"button",onClick:H=>L(b,g)},[m(h,{icon:"file-invoice"})],8,rt),t("span",ut,p(i.$t("pages.labels.component"))+" "+p((b.order=E)+1)+" - "+p(b.name),1)])])])),[[_]])],2)]),header:w(()=>[t("div",dt,[t("p",null,p(i.$t("pages.labels.addComponentsToSection",{section:g})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("div",pt,[g&&g!==e.sections.length-1?(u(),V(h,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),g?(u(),f("span",gt,p(i.$t(g===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:v.order=g})),1)):(u(),f("span",mt,[m(h,{icon:"heading"}),R(" "+p(i.$t("pages.labels.header")),1)])),t("button",{onClick:b=>N(g)},[m(h,{icon:"trash"})],8,vt)])])],2)]),_:1},8,["list"]),m(Q,{onClick:A})])])],64)}}});const Vt=B(bt,[["__scopeId","data-v-e0b71d93"]]);export{St as P,Vt as a};
