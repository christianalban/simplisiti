import{v as H,i as ie,g as le,c as ce}from"./helpers-66e66eca.js";import{d as E,e as C,f as A,r as I,o as p,c as h,h as o,y as w,I as re,a as d,j as U,t as m,v as Q,l as S,J as ue,_ as z,k as F,w as T,n as V,g as X,F as j,i as de,p as pe,m as me,D as ge,K as ve,L as q,z as G}from"./index-2a0e0e4b.js";import{D as W}from"./vuedraggable.umd-7383d61c.js";import{g as fe,b as be}from"./ComponentService-d24a377f.js";import{_ as he}from"./Group.vue_vue_type_script_setup_true_lang-76f23dfe.js";import{a as _e,u as ye,b as $e}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-41a45fa7.js";import{u as Y}from"./ResourceService-a55a40be.js";import{b as J}from"./PageService-7d7aa646.js";const ke=["onMousedown"],we=E({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const s=e,n=C(500),a=A(()=>`position-${s.position}-0`),g=A(()=>{switch(s.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),c=t=>{const i=t.clientX,r=n.value,u=R=>{const L=s.position==="left"?r+(R.clientX-i):r-(R.clientX-i);n.value=L<200?200:L},f=()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",f)};window.addEventListener("mousemove",u),window.addEventListener("mouseup",f)};return(t,i)=>{const r=I("fa-icon");return p(),h("div",{style:ue({width:e.canResize&&!e.isInvisible?`${n.value}px`:`${["left","right"].includes(e.position)?"initial":"100%"}`}),class:w(["float-toolbar",g.value,a.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[o("div",{class:w(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[o("div",{class:w(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[o("div",{class:w(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[re(t.$slots,"default",{},void 0,!0)],2)],2),o("div",{class:w(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":e.position==="top","float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right"}])},[o("button",{class:w(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:i[0]||(i[0]=u=>t.$emit("update:isInvisible",!e.isInvisible))},[d(r,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),U(" "+m(e.isInvisible?e.showLabel||t.$t("buttons.show"):e.hiddeLabel||t.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(p(),h("div",{key:0,class:"border-l-2 border-l-gray-200 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:Q(c,["prevent","stop"])},null,40,ke)):S("",!0)],6)}}});const Z=z(we,[["__scopeId","data-v-4b1b3a7f"]]),Ce={class:"toolbar-container"},Se={class:"toolbar-actions"},Te={type:"submit",class:"button-link"},Ve={class:"title"},Ie=["href"],Ee={class:"toolbar-route"},Re={class:"toolbar-route-input"},Le={class:"label"},De=["value","placeholder"],Fe={class:"toolbar-route-input"},Ue={class:"label"},ze=["value","placeholder"],Be={class:"toolbar-route-input"},Me={class:"label"},Ae=["value","placeholder"],Pe=E({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const s=C(!0);return(n,a)=>{const g=I("fa-icon"),c=I("router-link");return p(),F(Z,{isInvisible:s.value,"onUpdate:isInvisible":a[4]||(a[4]=t=>s.value=t),showLabel:n.$t("pages.buttons.settings")},{default:T(()=>[o("div",Ce,[o("div",Se,[d(c,{class:"button-link",to:{name:"pages.index"}},{default:T(()=>[d(g,{icon:"arrow-left"}),U(" "+m(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(p(),h("button",{key:0,onClick:a[0]||(a[0]=t=>n.$emit("delete")),type:"button",class:"button-link danger"},m(n.$t("buttons.delete")),1)):S("",!0),o("button",Te,m(n.$t("buttons.save")),1),o("h1",Ve,[U(m(e.title)+" ",1),e.showDelete?(p(),h("a",{key:0,href:e.url,target:"_blank"},[d(g,{icon:"external-link-alt"})],8,Ie)):S("",!0)])]),o("div",Ee,[o("div",Re,[o("label",Le,m(n.$t("pages.labels.pageName")),1),o("input",{class:"input",type:"text",required:"",value:e.name,onInput:a[1]||(a[1]=t=>n.$emit("update:name",V(H)(t.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,De)]),o("div",Fe,[o("label",Ue,m(n.$t("pages.labels.pageTitle")),1),o("input",{class:"input",type:"text",value:e.pageTitle,onInput:a[2]||(a[2]=t=>n.$emit("update:pageTitle",V(ie)(t.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,ze)]),o("div",Be,[o("label",Me,m(n.$t("pages.labels.pageUrl")),1),o("input",{class:"input",type:"text",value:e.url,onInput:a[3]||(a[3]=t=>n.$emit("update:url",V(H)(t.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,Ae)])])])]),_:1},8,["isInvisible","showLabel"])}}});const Dt=z(Pe,[["__scopeId","data-v-e5b92884"]]),Ne={class:"tile h-24 cursor-pointer"},Oe={class:"tile-title cursor-grab active:cursor-grabbing"},We=E({__name:"AvailableComponents",setup(e){const s=C([]),n=A(()=>le(s.value)),a=C(!1),g=t=>{const i={};t.variables.forEach(u=>{i[u.name]=null});const r={id:t.id||1+1,...t,variables:t.variables.map(u=>({...u})),content:i};return delete r.content_id,r},c=()=>{a.value=!0,fe({withData:!0}).then(t=>{s.value=t.data.data}).finally(()=>{a.value=!1})};return X(()=>{c()}),(t,i)=>{const r=I("fa-icon");return p(),h(j,null,[o("button",{onClick:c,type:"button",class:"button secondary"},[d(r,{icon:"sync",class:w({"animate-spin":a.value})},null,8,["class"]),U(" "+m(t.$t("components.buttons.refresh")),1)]),d(he,{items:n.value},{default:T(u=>[d(V(W),{class:"grid grid-cols-2 gap-4",modelValue:u.item,"onUpdate:modelValue":f=>u.item=f,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:g,"item-key":"id"},{item:T(({element:f})=>[o("div",Ne,[o("label",Oe,m(V(ce)(f.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])],64)}}}),xe={key:0,class:"component-configuration-parameters"},Xe={class:"component-configuration-label"},je=E({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:s}){const n=(a,g)=>{a.content&&(a.content[g]=null)};return(a,g)=>{const c=I("fa-icon");return e.component?(p(),h("div",xe,[(p(!0),h(j,null,de(e.component.variables,t=>(p(),h("div",{key:t.name},[o("div",Xe,[o("label",null,m(t.name)+":",1),d(c,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:i=>n(e.component,t.name)},null,8,["onClick"])]),e.component.content?(p(),F(_e,{key:0,editStructure:!1,modelValue:e.component.content[t.name],"onUpdate:modelValue":i=>e.component.content[t.name]=i,"default-value":t.default,name:t.name,type:t.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)}}});const He=z(je,[["__scopeId","data-v-848403e1"]]),qe=e=>(pe("data-v-e8ede51d"),e=e(),me(),e),Ge=qe(()=>o("hr",null,null,-1)),Je=E({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(s,n)=>{const a=I("fa-icon");return p(),h("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=Q(g=>s.$emit("click"),["stop"])),type:"button"},[Ge,o("span",null,[d(a,{icon:"square-plus"}),U(" "+m(s.$t("pages.buttons.addSection")),1)])])}}});const K=z(Je,[["__scopeId","data-v-e8ede51d"]]),{resourceFromId:Ke}=Y(),x=e=>typeof e=="string"?e==null?void 0:e.toString():"",Qe=e=>(typeof e=="number"||typeof e=="string")&&Ke(+e).url||"",Ye=e=>{if(typeof e!="number"||typeof e!="string"){const s=e;return s.rows.reduce((n,a)=>{const g=s.columns.reduce((c,t)=>{const i=a.find(f=>f.name===t.name),r=(i==null?void 0:i.value)||(i==null?void 0:i.default);if(!i||!r)return c;const u=ee(i==null?void 0:i.type,r);return c[t.name]=u,c},{});return[...n,g]},[])}return[]},ee=(e,s)=>{switch(e){case"text":return x(s);case"resource":return Qe(s);case"datatable":return Ye(s);case"textarea":return x(s);default:return""}},Ze=(e,s,n)=>e.replaceAll(new RegExp(`{{\\s*\\$${s.name}\\s*}}`,"g"),x(n)),et=(e,s,n)=>[...e.matchAll(new RegExp(`<x-simplisiti::list-render.*${s.name}.*?</x-simplisiti::list-render>`,"gs"))].reduce((g,c)=>{const t=c[0],i=t?t.replace(new RegExp(/<x-simplisiti::list-render.*items.*>/,"m"),"").replace(new RegExp(/<\/x-simplisiti::list-render>/,"m"),""):"",r=[...i.matchAll(new RegExp(/\@{[{!]+\s*\$dt->(.*.)(!!|})+}/g))],u=n||s.value;if(!u)return g;const f=u.reduce((R,L)=>R+r.reduce((P,B)=>{const N=B[1].trim(),O=B[0].trim();return P.replaceAll(O,L[N])},i),"");return g.replace(t,f)},e),tt=(e,s,n)=>{let a=e;return(s.type==="datatable"||s.type==="datasource")&&(a=et(a,s,n)),(s.type==="text"||s.type==="textarea"||s.type==="resource")&&(a=Ze(a,s,n)),a},ot={class:"relative"},nt=o("div",{class:"absolute inset-0"},null,-1),st=E({__name:"SectionPreview",props:{content:{type:String,default:""}},setup(e){const s=e,n=C(null),a=c=>{if(n.value){const t=n.value.contentDocument;if(!t)return;const[i,r]=g();t.open(),t.write(c),t.head.appendChild(i),t.body.appendChild(r),t.close(),n.value.onload=()=>{const u=t.body.scrollHeight;n.value&&(n.value.style.height=`${u}px`)}}},g=()=>{const c=document.createElement("link"),t=document.createElement("script"),i=J("style"),r=J("script");return c.rel="stylesheet",c.href=i,t.src=r,t.async=!0,[c,t]};return ge(()=>s.content,c=>{a(c)}),X(()=>{a(s.content)}),(c,t)=>(p(),h("div",ot,[o("iframe",{class:"w-screen",ref_key:"iframe",ref:n,sandbox:"allow-scripts allow-same-origin"},null,512),nt]))}}),at={class:"w-full p-4 h-screen flex flex-col overflow-y-auto"},it={class:"form-group"},lt={class:"page-sections-container"},ct={class:"page-sections-content"},rt={class:"page-sections-item-panel"},ut={class:"page-sections-preview"},dt={class:"page-sections-preview-content"},pt={class:"page-sections-item-buttons"},mt={class:"page-sections-components-grip-lines"},gt={class:"pages-secttions-component-buttons"},vt=["onClick"],ft=["onClick"],bt={class:"page-sections-label"},ht={class:"hideable-header"},_t={class:"page-sections-buttons"},yt={key:1},$t={key:2},kt=["onClick"],wt=E({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:0,components:[]}]},pageEditionMode:{type:String,default:"adding-component"}},emits:["update:sections"],setup(e,{emit:s}){const{loadResources:n}=Y(),{loadSources:a}=ye(),{loadActions:g}=$e(),c=e,t=C(!0),i=s,r=C(null),u=C(null),f=C("adding-component"),R=l=>{const v=[...c.sections];v.splice(l,0,q({order:0,components:[]})),i("update:sections",v)},L=()=>{i("update:sections",[...c.sections,q({order:0,components:[]})])},P=l=>{const v=[...c.sections];v.splice(l,1),i("update:sections",v)},B=(l,v)=>{l.splice(v,1)},N=(l,v)=>{t.value=!1,f.value="editing-component",r.value=l,u.value=v},O=()=>{t.value=!0,f.value="adding-component",r.value=null,u.value=null},te=l=>(l.content=l.content||be(l),l.variables.reduce((_,k)=>{var $;const y=l.content&&l.content[k.name]?l.content[k.name]:($=l.variables.find(M=>M.name===k.name))==null?void 0:$.default,b=y?ee(k.type,y):"";return tt(_,k,b)},l.html)),oe=(l,v)=>{var _,k;return((_=r.value)==null?void 0:_.id)===l.id&&l.order===((k=r.value)==null?void 0:k.order)&&u.value===v},D=C("left"),ne=()=>{D.value=D.value==="left"?"right":"left"},se=A(()=>f.value==="adding-component"?"availableComponents":"componentConfigurationForm");return X(()=>{n(),a(),g()}),(l,v)=>{const _=I("fa-icon"),k=ve("autosize");return p(),h(j,null,[d(Z,{isInvisible:t.value,"onUpdate:isInvisible":v[1]||(v[1]=y=>t.value=y),position:D.value,showLabel:l.$t("pages.buttons.components"),canResize:!0},{default:T(()=>[o("div",at,[o("div",{class:w(`component-configuration-title ${D.value}`)},[o("h2",null,m(l.$t(`pages.titles.${se.value}`)),1),o("div",null,[o("div",it,[o("button",{type:"button",class:"button small default",onClick:O},m(l.$t("pages.buttons.exit")),1),o("button",{type:"button",class:"button small default button-position",onClick:ne},[d(_,{icon:"border-top-left"})])])])],2),f.value==="adding-component"?(p(),F(We,{key:0})):S("",!0),f.value==="editing-component"?(p(),F(He,{key:1,position:D.value,"onUpdate:position":v[0]||(v[0]=y=>D.value=y),component:r.value},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),o("div",lt,[o("div",ct,[d(V(W),{list:e.sections,class:"page-sections-panel",onInput:v[2]||(v[2]=y=>l.$emit("update:sections",y)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:T(({element:y,index:b})=>[o("div",{class:w(["page-sections-list-content",{"page-sections-list-header":!b,"page-sections-list-footer":b===e.sections.length-1}])},[b?(p(),F(K,{key:0,onClick:$=>R(b)},null,8,["onClick"])):S("",!0),o("div",rt,[d(V(W),{class:"page-sections-dreaggable",modelValue:y.components,"onUpdate:modelValue":$=>y.components=$,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:T(({element:$,index:M})=>[o("div",{class:w(["page-sections-item",{"page-sections-item-selected":oe($,b)}])},[G((p(),h("div",ut,[G((p(),h("div",dt,[d(st,{content:te($)},null,8,["content"])])),[[k]]),o("div",pt,[o("button",mt,[d(_,{icon:"grip"})]),o("div",gt,[o("button",{type:"button",onClick:ae=>B(y.components,M)},[d(_,{icon:"trash"})],8,vt),o("button",{type:"button",onClick:ae=>N($,b)},[d(_,{icon:"file-invoice"})],8,ft),o("span",bt,m(l.$t("pages.labels.component"))+" "+m(($.order=M)+1)+" - "+m($.name),1)])])])),[[k]])],2)]),header:T(()=>[o("div",ht,[d(_,{icon:"triangle-exclamation"}),o("p",null,m(l.$t("pages.labels.addComponentsToSection",{section:b})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),o("div",_t,[b&&b!==e.sections.length-1?(p(),F(_,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),b?(p(),h("span",$t,m(l.$t(b===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:y.order=b})),1)):(p(),h("span",yt,[d(_,{icon:"heading"}),U(" "+m(l.$t("pages.labels.header")),1)])),o("button",{onClick:$=>P(b)},[d(_,{icon:"trash"})],8,kt)])])],2)]),_:1},8,["list"]),d(K,{onClick:L})])])],64)}}});const Ft=z(wt,[["__scopeId","data-v-4d1ae331"]]);export{Dt as P,Ft as a};
