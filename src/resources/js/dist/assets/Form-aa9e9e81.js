import{n as x,v as G,o as be,a as fe,p as he,l as _e,b as $e,u as ye}from"./helpers-315eb150.js";import{d as F,e as g,f as B,r as T,o as u,c as b,h as t,A as S,I as Ce,a,j as U,t as p,q as H,l as D,J as we,_ as R,k as E,w as I,n as L,g as Q,y as N,z as ke,F as X,i as Se,p as Y,m as Z,K as Ie,L as J}from"./index-0d1f3313.js";import{D as W}from"./vuedraggable.umd-174a2cc0.js";import{_ as De}from"./Dialog.vue_vue_type_script_setup_true_lang-435bc5e4.js";import{g as Ve}from"./ComponentService-3dc17eda.js";import{C as Te,_ as ze}from"./ComponentFloatingPreview-01b5b00d.js";import{g as ee,p as te,a as Le,u as Me,b as Pe}from"./LocalStorageService-61e16c7a.js";import{u as oe,_ as Ue}from"./ComponentPreview.vue_vue_type_script_setup_true_lang-d98e3bdc.js";import{u as Fe}from"./ResourceService-303ee50b.js";const Be=["onMousedown"],Ee=F({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const r=e,o=g(ee("float-toolbar-width",500)),l=g(x()),f=B(()=>`position-${r.position}-0`),$=B(()=>{switch(r.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),i=n=>{const d=n.clientX,m=o.value,_=y=>{const M=r.position==="left"?m+(y.clientX-d):m-(y.clientX-d);o.value=M<200?200:M,te("float-toolbar-width",o.value)},V=()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",V)};window.addEventListener("mousemove",_),window.addEventListener("mouseup",V)},v=B(()=>l.value?"100%":r.canResize&&!r.isInvisible?`${o.value}px`:`${["left","right"].includes(r.position)?"initial":"100%"}`);return(n,d)=>{const m=T("fa-icon");return u(),b("div",{style:we({width:v.value}),class:S(["float-toolbar",$.value,f.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:S(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:S(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:S(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[Ce(n.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:S(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":["top","bottom"].includes(e.position),"float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right",bottom:e.position==="bottom",top:e.position==="top"}])},[t("button",{class:S(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:d[0]||(d[0]=_=>n.$emit("update:isInvisible",!e.isInvisible))},[a(m,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),U(" "+p(e.isInvisible?e.showLabel||n.$t("buttons.show"):e.hiddeLabel||n.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(u(),b("div",{key:0,class:"border-l-2 border-l-gray-400 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:H(i,["prevent","stop"])},null,40,Be)):D("",!0)],6)}}});const ne=R(Ee,[["__scopeId","data-v-511c8ca4"]]),Re={class:"toolbar-container"},Ae={class:"toolbar-actions"},Ne={class:"flex gap-2"},We={type:"submit",class:"button primary"},Xe={class:"title"},je=["href"],qe={class:"toolbar-route"},Oe={class:"toolbar-route-input"},Ge={class:"label"},Je=["value","placeholder"],Ke={class:"toolbar-route-input"},xe={class:"label"},He=["value","placeholder"],Qe={class:"toolbar-route-input"},Ye={class:"label"},Ze=["value","placeholder"],et=F({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const r=g(!0);return(o,l)=>{const f=T("fa-icon"),$=T("router-link");return u(),E(ne,{isInvisible:r.value,"onUpdate:isInvisible":l[4]||(l[4]=i=>r.value=i),showLabel:o.$t("pages.buttons.settings")},{default:I(()=>[t("div",Re,[t("div",Ae,[t("div",Ne,[a($,{class:"button secondary",to:{name:"pages.index"}},{default:I(()=>[a(f,{icon:"arrow-left"}),U(" "+p(o.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(u(),b("button",{key:0,onClick:l[0]||(l[0]=i=>o.$emit("delete")),type:"button",class:"button danger"},p(o.$t("buttons.delete")),1)):D("",!0),t("button",We,p(o.$t("buttons.save")),1)]),t("h1",Xe,[U(p(e.title)+" ",1),e.showDelete?(u(),b("a",{key:0,href:e.url,target:"_blank"},[a(f,{icon:"external-link-alt"})],8,je)):D("",!0)])]),t("div",qe,[t("div",Oe,[t("label",Ge,p(o.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:l[1]||(l[1]=i=>o.$emit("update:name",L(G)(i.target))),placeholder:o.$t("pages.placeholders.pageName")},null,40,Je)]),t("div",Ke,[t("label",xe,p(o.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:l[2]||(l[2]=i=>o.$emit("update:pageTitle",L(be)(i.target))),placeholder:o.$t("pages.placeholders.pageTitle")},null,40,He)]),t("div",Qe,[t("label",Ye,p(o.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:l[3]||(l[3]=i=>o.$emit("update:url",L(G)(i.target))),placeholder:o.$t("pages.placeholders.pageUrl")},null,40,Ze)])])])]),_:1},8,["isInvisible","showLabel"])}}});const qt=R(et,[["__scopeId","data-v-48fae850"]]),tt=["placeholder"],ot={class:"overflow-y-auto mt-2"},nt={class:"tile h-24 cursor-pointer flex flex-col"},st={class:"flex items-center justify-between px-2 py-1"},at={class:"flex flex-col"},lt={class:"font-semibold"},it=F({__name:"AvailableComponents",setup(e){const r=g([]),o=B(()=>fe(r.value)),l=g(!1),f=g(""),$=v=>{const n={};v.variables.forEach(m=>{n[m.name]=null});const d={id:v.id||1+1,...v,variables:v.variables.map(m=>({...m})),content:n};return delete d.content_id,d},i=()=>{Promise.all([_e(),$e()]).then(()=>{l.value=!0,Ve({withData:!0}).then(n=>{r.value=n.data.data}).finally(()=>{l.value=!1})})};return Q(()=>{i()}),(v,n)=>{const d=T("fa-icon");return u(),b(X,null,[t("button",{onClick:i,type:"button",class:"button secondary"},[a(d,{icon:"sync",class:S({"animate-spin":l.value})},null,8,["class"]),U(" "+p(v.$t("components.buttons.refresh")),1)]),N(t("input",{"onUpdate:modelValue":n[0]||(n[0]=m=>f.value=m),type:"search",class:"input mt-4",placeholder:v.$t("placeholders.search")},null,8,tt),[[ke,f.value]]),t("div",ot,[a(ze,{items:o.value,filter:f.value},{default:I(m=>[a(L(W),{class:"grid grid-cols-2 gap-4",modelValue:m.item,"onUpdate:modelValue":_=>m.item=_,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:$,"item-key":"id"},{item:I(({element:_,index:V})=>[t("div",nt,[t("div",st,[t("div",at,[t("span",lt,p(L(he)(_.name)),1)])]),a(Te,{component:_,class:"flex-1 tile-title cursor-pointer active:cursor-grabbing",position:V%2===0?"left":"right"},null,8,["component","position"])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items","filter"])])],64)}}}),ct={key:0,class:"component-configuration-parameters"},ut={class:"component-configuration-label"},rt={class:"max-h-[4rem] flex overflow-hidden"},dt=F({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:r}){const o=oe(),l=($,i)=>{$.content&&($.content[i]=null)},f=()=>{o.update()};return($,i)=>{const v=T("fa-icon");return e.component?(u(),b("div",ct,[(u(!0),b(X,null,Se(e.component.variables,n=>(u(),b("div",{key:n.name},[t("div",ut,[t("label",null,p(n.name)+":",1),a(v,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:d=>l(e.component,n.name)},null,8,["onClick"])]),t("div",rt,[e.component.content?(u(),E(Le,{key:0,editStructure:!1,modelValue:e.component.content[n.name],"onUpdate:modelValue":[d=>e.component.content[n.name]=d,f],"default-value":n.default,name:n.name,type:n.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):D("",!0)])]))),128))])):D("",!0)}}});const pt=R(dt,[["__scopeId","data-v-53195aea"]]),mt=e=>(Y("data-v-e8ede51d"),e=e(),Z(),e),vt=mt(()=>t("hr",null,null,-1)),gt=F({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(r,o)=>{const l=T("fa-icon");return u(),b("button",{class:"page-sections-buttons-add",onClick:o[0]||(o[0]=H(f=>r.$emit("click"),["stop"])),type:"button"},[vt,t("span",null,[a(l,{icon:"square-plus"}),U(" "+p(r.$t("pages.buttons.addSection")),1)])])}}});const K=R(gt,[["__scopeId","data-v-e8ede51d"]]),bt=e=>(Y("data-v-66382130"),e=e(),Z(),e),ft={class:"w-full p-4 flex flex-col h-[60vh] md:h-full"},ht={class:"form-group"},_t={class:"page-sections-container"},$t={class:"page-sections-content"},yt={class:"page-sections-item-panel"},Ct={class:"page-sections-preview"},wt=["onClick"],kt=bt(()=>t("div",{class:"absolute inset-0 cursor-pointer transition-colors hover:bg-yellow-400 active:bg-yellow-200 opacity-50 z-10"},null,-1)),St={class:"page-sections-item-buttons"},It={class:"pages-secttions-component-buttons"},Dt=["onClick"],Vt={class:"page-sections-label"},Tt={class:"hideable-header"},zt={class:"page-sections-buttons"},Lt={key:0},Mt={key:1},Pt=["onClick"],Ut=F({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:1,components:[]}]},pageEditionMode:{type:String,default:"adding-component"}},emits:["update:sections"],setup(e,{emit:r}){const{loadResources:o}=Fe(),{loadSources:l}=Me(),{loadActions:f}=Pe(),{loadPages:$}=ye(),i=g(!1),v=oe(),n=e,d=g(!0),m=r,_=g(null),V=g(null),y=g(null),M=g(null),P=g("adding-component"),se=s=>{const c=[...n.sections];c.splice(s,0,J({order:0,components:[]})),m("update:sections",c)},ae=()=>{m("update:sections",[...n.sections,J({order:0,components:[]})])},le=s=>{const c=[...n.sections];c.splice(s,1),m("update:sections",c)},ie=()=>{var s;(s=V.value)==null||s.components.splice(_.value||0,1),_.value=null,V.value=null,y.value=null},ce=(s,c)=>{d.value=!1,P.value="editing-component",y.value=s,M.value=c,v.attach(s)},ue=()=>{d.value=!0,P.value="adding-component",v.detach(),y.value=null,M.value=null},re=(s,c)=>{var C,A;return((C=y.value)==null?void 0:C.id)===s.id&&s.order===((A=y.value)==null?void 0:A.order)&&M.value===c},j=g(x()),z=g(ee("float-toolbar-position",j.value?"bottom":"left")),de=()=>{z.value=z.value==="left"?"right":"left",te("float-toolbar-position",z.value)},pe=B(()=>P.value==="adding-component"?"availableComponents":"componentConfigurationForm"),me=(s,c,C)=>{y.value=s,_.value=c,V.value=C,i.value=!0};return Q(()=>{o(),l(),f(),$()}),(s,c)=>{var O;const C=T("fa-icon"),A=T("router-link"),q=Ie("autosize");return u(),b(X,null,[a(ne,{isInvisible:d.value,"onUpdate:isInvisible":c[1]||(c[1]=h=>d.value=h),position:z.value,showLabel:s.$t(P.value==="editing-component"?"pages.buttons.settings":"pages.buttons.components"),canResize:!0},{default:I(()=>[t("div",ft,[t("div",{class:S(`component-configuration-title ${z.value}`)},[t("h2",null,p(s.$t(`pages.titles.${pe.value}`)),1),t("div",null,[t("div",ht,[t("button",{type:"button",class:"button small default",onClick:ue},p(s.$t("pages.buttons.exit")),1),j.value?D("",!0):(u(),b("button",{key:0,type:"button",class:"button small default button-position",onClick:de},[a(C,{icon:"arrows-down-to-line"})]))])])],2),P.value==="adding-component"?(u(),E(it,{key:0})):D("",!0),P.value==="editing-component"?(u(),E(pt,{key:1,position:z.value,"onUpdate:position":c[0]||(c[0]=h=>z.value=h),component:y.value},null,8,["position","component"])):D("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",_t,[t("div",$t,[a(L(W),{list:e.sections,class:"page-sections-panel",onInput:c[2]||(c[2]=h=>s.$emit("update:sections",h)),group:"sections","item-key":"id"},{item:I(({element:h,index:w})=>[t("div",{class:S(["page-sections-list-content",{"page-sections-list-header":!w,"page-sections-list-footer":w===e.sections.length-1}])},[w?(u(),E(K,{key:0,onClick:k=>se(w)},null,8,["onClick"])):D("",!0),t("div",yt,[a(L(W),{class:"page-sections-dreaggable",modelValue:h.components,"onUpdate:modelValue":k=>h.components=k,disabled:h.components.length===1,group:"components","item-key":"id"},{item:I(({element:k,index:ve})=>[t("div",{class:S(["page-sections-item",{"page-sections-item-selected":re(k,w)}])},[N((u(),b("div",Ct,[N((u(),b("div",{class:"page-sections-preview-content relative",onClick:ge=>ce(k,w)},[kt,a(Ue,{component:k,lazy:!0},null,8,["component"])],8,wt)),[[q]]),t("div",St,[t("div",It,[t("button",{type:"button",onClick:ge=>me(k,ve,h)},[a(C,{icon:"trash"})],8,Dt),a(A,{to:{name:"components.edit",params:{component:k.id}},target:"_blank"},{default:I(()=>[a(C,{icon:"edit"})]),_:2},1032,["to"]),t("span",Vt,p(k.name),1)])])])),[[q]])],2)]),header:I(()=>[t("div",Tt,[a(C,{icon:"triangle-exclamation"}),t("p",null,p(s.$t("pages.labels.addComponentsToSection",{section:w})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"]),t("div",zt,[w?(u(),b("span",Mt,p(s.$t(w===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:h.order=w})),1)):(u(),b("span",Lt,[a(C,{icon:"heading"}),U(" "+p(s.$t("pages.labels.header")),1)])),t("button",{onClick:k=>le(w)},[a(C,{icon:"trash"})],8,Pt)])])],2)]),_:1},8,["list"]),a(K,{onClick:ae})])]),a(De,{showDialog:i.value,"onUpdate:showDialog":c[3]||(c[3]=h=>i.value=h),title:s.$t("components.dialogs.delete.title"),message:s.$t("components.dialogs.delete.message",{name:(O=y.value)==null?void 0:O.name}),onConfirm:ie},null,8,["showDialog","title","message"])],64)}}});const Ot=R(Ut,[["__scopeId","data-v-66382130"]]);export{qt as P,Ot as a};
