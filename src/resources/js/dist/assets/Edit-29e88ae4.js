import{d as h,u as P,n as U,l as C,b as r,f as T,c as y,g as R,a as g,m as $,F as B,s as i,o as F}from"./index-63881d29.js";import{P as V,a as k}from"./Form-24f9fa2e.js";import{_ as E}from"./Dialog.vue_vue_type_script_setup_true_lang-2de0b6a9.js";import{a as I,d as M,u as N}from"./PageService-31dcdd43.js";import{u as S,p as x}from"./ResourceService-a05096a0.js";import"./helpers-6321440c.js";import"./vuedraggable.umd-3df87a88.js";import"./ComponentService-33601891.js";import"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-d1653569.js";import"./Modal.vue_vue_type_script_setup_true_lang-f7ab460b.js";import"./ResourcePreview-4b57b621.js";const j=["onSubmit"],Y=h({__name:"Edit",setup(q){const{t:s}=P(),c=U(),d=C(),o=r(""),l=r(""),n=r(""),p=r(!1),u=r([]),m=+c.params.page,{loadResources:v}=S(),f=()=>{N({id:m,name:o.value,url:l.value,title:n.value,sections:u.value}).then(()=>{d.push({name:"pages.index"}),i({title:s("toasts.success"),message:s("pages.toasts.updated"),type:"success"})}).catch(()=>{i({title:s("toasts.error"),message:s("pages.toasts.errorUpdated"),type:"error"})})},D=a=>a.map(e=>({...e,variables:e.variables.map(t=>x(e,t))})),w=()=>{p.value=!0},b=()=>{M(m).then(()=>{d.push({name:"pages.index"}),i({title:s("toasts.success"),message:s("pages.toasts.deleted"),type:"success"})}).catch(()=>{i({title:s("toasts.error"),message:s("pages.toasts.errorDeleted"),type:"error"})})};return T(()=>{I(m).then(a=>{const e=a.data.data;o.value=e.name,l.value=e.url,n.value=e.title,u.value=e.sections.map(t=>({...t,components:D(t.components)}))}),v()}),(a,e)=>(F(),y(B,null,[R("form",{onSubmit:$(f,["prevent"])},[g(V,{title:a.$t("pages.titles.editPage"),showDelete:!0,onDelete:w,name:o.value,"onUpdate:name":e[0]||(e[0]=t=>o.value=t),url:l.value,"onUpdate:url":e[1]||(e[1]=t=>l.value=t),pageTitle:n.value,"onUpdate:pageTitle":e[2]||(e[2]=t=>n.value=t)},null,8,["title","name","url","pageTitle"]),g(k,{sections:u.value,"onUpdate:sections":e[3]||(e[3]=t=>u.value=t)},null,8,["sections"])],40,j),g(E,{showDialog:p.value,"onUpdate:showDialog":e[4]||(e[4]=t=>p.value=t),title:a.$t("pages.dialogs.delete.title"),message:a.$t("pages.dialogs.delete.message",{name:o.value}),onConfirm:b},null,8,["showDialog","title","message"])],64))}});export{Y as default};
