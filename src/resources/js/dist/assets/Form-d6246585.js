import{v as G,i as ee,g as te,c as oe}from"./helpers-ddca868d.js";import{d as V,e as q,r as D,o as u,c as v,g as t,D as k,E as ne,a as m,i as U,t as d,_ as P,b as C,j as F,w,k as S,l as T,f as j,F as B,h as se,n as ie,G as ae,H as le,A as ce,I as re,J,q as K}from"./index-133838cc.js";import{D as x}from"./vuedraggable.umd-c0f704d2.js";import{g as ue,b as de}from"./ComponentService-a6ee9736.js";import{_ as pe}from"./Group.vue_vue_type_script_setup_true_lang-364dfc8b.js";import{a as me,u as ge}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-20a01ddb.js";import{u as X}from"./ResourceService-47560a4a.js";import{b as be}from"./PageService-26fda90c.js";const fe=V({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String}},emits:["update:isInvisible"],setup(e){const s=e,n=q(()=>`position-${s.position}-0`),c=q(()=>{switch(s.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}});return(i,l)=>{const o=D("fa-icon");return u(),v("div",{class:k(["float-toolbar",c.value,n.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[ne(i.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:k(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":e.position==="top","float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right"}])},[t("button",{class:k(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:l[0]||(l[0]=r=>i.$emit("update:isInvisible",!e.isInvisible))},[m(o,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),U(" "+d(e.isInvisible?e.showLabel||i.$t("buttons.show"):e.hiddeLabel||i.$t("buttons.hide")),1)],2)],2)],2)],2)}}});const Y=P(fe,[["__scopeId","data-v-f23dbdce"]]),ve={class:"toolbar-container"},he={class:"toolbar-actions"},_e={type:"submit",class:"button-link"},$e={class:"title"},ye=["href"],ke={class:"toolbar-route"},Ce={class:"toolbar-route-input"},we={class:"label"},Se=["value","placeholder"],Te={class:"toolbar-route-input"},Ve={class:"label"},Ie=["value","placeholder"],Fe={class:"toolbar-route-input"},De={class:"label"},Ee=["value","placeholder"],Ue=V({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const s=C(!0);return(n,c)=>{const i=D("fa-icon"),l=D("router-link");return u(),F(Y,{isInvisible:s.value,"onUpdate:isInvisible":c[4]||(c[4]=o=>s.value=o),showLabel:n.$t("pages.buttons.settings")},{default:w(()=>[t("div",ve,[t("div",he,[m(l,{class:"button-link",to:{name:"pages.index"}},{default:w(()=>[m(i,{icon:"arrow-left"}),U(" "+d(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(u(),v("button",{key:0,onClick:c[0]||(c[0]=o=>n.$emit("delete")),type:"button",class:"button-link danger"},d(n.$t("buttons.delete")),1)):S("",!0),t("button",_e,d(n.$t("buttons.save")),1),t("h1",$e,[U(d(e.title)+" ",1),e.showDelete?(u(),v("a",{key:0,href:e.url,target:"_blank"},[m(i,{icon:"external-link-alt"})],8,ye)):S("",!0)])]),t("div",ke,[t("div",Ce,[t("label",we,d(n.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:c[1]||(c[1]=o=>n.$emit("update:name",T(G)(o.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,Se)]),t("div",Te,[t("label",Ve,d(n.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:c[2]||(c[2]=o=>n.$emit("update:pageTitle",T(ee)(o.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,Ie)]),t("div",Fe,[t("label",De,d(n.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:c[3]||(c[3]=o=>n.$emit("update:url",T(G)(o.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,Ee)])])])]),_:1},8,["isInvisible","showLabel"])}}});const wt=P(Ue,[["__scopeId","data-v-e5b92884"]]),Pe={class:"font-bold"},Re={class:"tile h-24 cursor-pointer"},Be={class:"tile-title cursor-grab active:cursor-grabbing"},Le=V({__name:"AvailableComponents",setup(e){const s=C([]),n=q(()=>te(s.value)),c=i=>{const l={};i.variables.forEach(r=>{l[r.name]=null});const o={id:i.id||1+1,...i,variables:i.variables.map(r=>({...r})),content:l};return delete o.content_id,o};return j(()=>{ue({withData:!0}).then(i=>{s.value=i.data.data})}),(i,l)=>(u(),v(B,null,[t("h2",Pe,d(i.$t("pages.titles.availableComponents")),1),m(pe,{items:n.value},{default:w(o=>[m(T(x),{class:"grid grid-cols-2 gap-4",modelValue:o.item,"onUpdate:modelValue":r=>o.item=r,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:c,"item-key":"id"},{item:w(({element:r})=>[t("div",Re,[t("label",Be,d(T(oe)(r.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])],64))}}),Ae={class:"form-group"},Ne={key:0,class:"component-configuration-parameters"},Me={class:"component-configuration-label"},ze=V({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["exit","update:position"],setup(e,{emit:s}){const n=e,c=s,i=()=>{const o=n.position==="left"?"right":"left";c("update:position",o)},l=(o,r)=>{o.content&&(o.content[r]=null)};return(o,r)=>{const _=D("fa-icon");return u(),v(B,null,[t("div",{class:k(`component-configuration-title ${e.position}`)},[t("h2",null,d(o.$t("pages.titles.componentConfigurationForm")),1),t("div",null,[t("div",Ae,[t("button",{type:"button",class:"button small default",onClick:r[0]||(r[0]=g=>o.$emit("exit"))},d(o.$t("pages.buttons.exit")),1),t("button",{type:"button",class:"button small default button-position",onClick:i},[m(_,{icon:"border-top-left"})])])])],2),e.component?(u(),v("div",Ne,[(u(!0),v(B,null,se(e.component.variables,g=>(u(),v("div",{key:g.name},[t("div",Me,[t("label",null,d(g.name)+":",1),m(_,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:I=>l(e.component,g.name)},null,8,["onClick"])]),e.component.content?(u(),F(me,{key:0,modelValue:e.component.content[g.name],"onUpdate:modelValue":I=>e.component.content[g.name]=I,"default-value":g.default,name:g.name,type:g.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)],64)}}});const Oe=P(ze,[["__scopeId","data-v-2c350eb3"]]),He=e=>(ae("data-v-e8ede51d"),e=e(),le(),e),qe=He(()=>t("hr",null,null,-1)),xe=V({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(s,n)=>{const c=D("fa-icon");return u(),v("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=ie(i=>s.$emit("click"),["stop"])),type:"button"},[qe,t("span",null,[m(c,{icon:"square-plus"}),U(" "+d(s.$t("pages.buttons.addSection")),1)])])}}});const Q=P(xe,[["__scopeId","data-v-e8ede51d"]]),{resourceFromId:We}=X(),W=e=>typeof e=="string"?e:"",je=e=>(typeof e=="number"||typeof e=="string")&&We(+e).url||"",Ge=(e,s)=>{switch(e){case"text":return W(s);case"resource":return je(s);case"datatable":return s;case"textarea":return W(s);default:return""}},Je=(e,s,n)=>e.replace(`{{ $${s.name} }}`,W(n)),Ke=(e,s,n)=>[...e.matchAll(new RegExp(`<x-simplisiti::list-render.*${s.name}.*?</x-simplisiti::list-render>`,"gs"))].reduce((i,l)=>{const o=l[0],r=o?o.replace(new RegExp(/<x-simplisiti::list-render.*items.*>/,"m"),"").replace(new RegExp(/<\/x-simplisiti::list-render>/,"m"),""):"",_=[...r.matchAll(new RegExp(/\@{[{!]+\$dt->(.*.)(!!|})+}/g))],I=(n||s.value).reduce((L,A)=>L+_.reduce((N,R)=>{const M=R[1],z=R[0];return N.replaceAll(z,A[M])},r),"");return i.replace(o,I)},e),Qe=(e,s,n)=>{switch(s.type){case"text":return Je(e,s,n);case"resource":return e;case"datatable":return e;case"textarea":return e;case"datasource":return Ke(e,s,n);default:return e}},Xe=V({__name:"SectionPreview",props:{content:{type:String,default:""}},setup(e){const s=e,n=C(null),c=l=>{if(n.value){const o=n.value.contentDocument;if(!o)return;const r=i();o.open(),o.write(l),o.head.appendChild(r),o.close(),setTimeout(()=>{const _=o.body.firstChild,g=_==null?void 0:_.clientHeight;n.value&&(n.value.style.height=`${g}px`)},1e3)}},i=()=>{const l=document.createElement("link"),o=be("style");return l.rel="stylesheet",l.href=o,l};return ce(()=>s.content,l=>{c(l)}),j(()=>{c(s.content)}),(l,o)=>(u(),v("iframe",{class:"w-screen",ref_key:"iframe",ref:n},null,512))}}),Ye={class:"w-[30vw] p-4 h-screen flex flex-col overflow-y-auto"},Ze={class:"page-sections-container"},et={class:"page-sections-content"},tt={class:"page-sections-item-panel"},ot={class:"page-sections-preview"},nt={class:"page-sections-preview-content"},st={class:"page-sections-item-buttons"},it={class:"page-sections-components-grip-lines"},at={class:"pages-secttions-component-buttons"},lt=["onClick"],ct=["onClick"],rt={class:"page-sections-label"},ut={class:"hideable-header"},dt={class:"page-sections-buttons"},pt={key:1},mt={key:2},gt=["onClick"],bt=V({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:0,components:[]}]}},emits:["update:sections"],setup(e,{emit:s}){const{loadResources:n}=X(),{loadSources:c}=ge(),i=e,l=C(!0),o=s,r=C(null),_=C(null),g=C("adding-component"),I=a=>{const p=[...i.sections];p.splice(a,0,J({order:0,components:[]})),o("update:sections",p)},L=()=>{o("update:sections",[...i.sections,J({order:0,components:[]})])},A=a=>{const p=[...i.sections];p.splice(a,1),o("update:sections",p)},N=(a,p)=>{a.splice(p,1)},R=(a,p)=>{l.value=!1,g.value="editing-component",r.value=a,_.value=p},M=()=>{l.value=!0,g.value="adding-component",r.value=null,_.value=null},z=a=>(a.content=a.content||de(a),a.variables.reduce(($,y)=>{var E;const f=a.content&&a.content[y.name]?a.content[y.name]:(E=a.variables.find(H=>H.name===y.name))==null?void 0:E.default,b=f?Ge(y.type,f==null?void 0:f.toString()):"";let h="";return typeof b=="string"?h=b:h=JSON.stringify(b),Qe($,y,h||"")},a.html)),Z=(a,p)=>{var $,y;return(($=r.value)==null?void 0:$.id)===a.id&&a.order===((y=r.value)==null?void 0:y.order)&&_.value===p},O=C("left");return j(()=>{n(),c()}),(a,p)=>{const $=D("fa-icon"),y=re("autosize");return u(),v(B,null,[m(Y,{isInvisible:l.value,"onUpdate:isInvisible":p[1]||(p[1]=f=>l.value=f),position:O.value,showLabel:a.$t("pages.buttons.components")},{default:w(()=>[t("div",Ye,[g.value==="adding-component"?(u(),F(Le,{key:0})):S("",!0),g.value==="editing-component"?(u(),F(Oe,{key:1,position:O.value,"onUpdate:position":p[0]||(p[0]=f=>O.value=f),component:r.value,onExit:M},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",Ze,[t("div",et,[m(T(x),{list:e.sections,class:"page-sections-panel",onInput:p[2]||(p[2]=f=>a.$emit("update:sections",f)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:w(({element:f,index:b})=>[t("div",{class:k(["page-sections-list-content",{"page-sections-list-header":!b,"page-sections-list-footer":b===e.sections.length-1}])},[b?(u(),F(Q,{key:0,onClick:h=>I(b)},null,8,["onClick"])):S("",!0),t("div",tt,[m(T(x),{class:"page-sections-dreaggable",modelValue:f.components,"onUpdate:modelValue":h=>f.components=h,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:w(({element:h,index:E})=>[t("div",{class:k(["page-sections-item",{"page-sections-item-selected":Z(h,b)}])},[K((u(),v("div",ot,[K((u(),v("div",nt,[m(Xe,{content:z(h)},null,8,["content"])])),[[y]]),t("div",st,[t("button",it,[m($,{icon:"grip"})]),t("div",at,[t("button",{type:"button",onClick:H=>N(f.components,E)},[m($,{icon:"trash"})],8,lt),t("button",{type:"button",onClick:H=>R(h,b)},[m($,{icon:"file-invoice"})],8,ct),t("span",rt,d(a.$t("pages.labels.component"))+" "+d((h.order=E)+1)+" - "+d(h.name),1)])])])),[[y]])],2)]),header:w(()=>[t("div",ut,[t("p",null,d(a.$t("pages.labels.addComponentsToSection",{section:b})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("div",dt,[b&&b!==e.sections.length-1?(u(),F($,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),b?(u(),v("span",mt,d(a.$t(b===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:f.order=b})),1)):(u(),v("span",pt,[m($,{icon:"heading"}),U(" "+d(a.$t("pages.labels.header")),1)])),t("button",{onClick:h=>A(b)},[m($,{icon:"trash"})],8,gt)])])],2)]),_:1},8,["list"]),m(Q,{onClick:L})])])],64)}}});const St=P(bt,[["__scopeId","data-v-460b8274"]]);export{wt as P,St as a};
