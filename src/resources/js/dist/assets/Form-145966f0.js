var re=Object.defineProperty;var ue=(e,n,o)=>n in e?re(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o;var B=(e,n,o)=>(ue(e,typeof n!="symbol"?n+"":n,o),o);import{v as H,i as de,g as pe,c as me}from"./helpers-66e66eca.js";import{d as L,e as k,f as P,r as V,o as p,c as f,h as t,y as C,I as ve,a as d,j as F,t as v,v as K,l as S,J as be,_ as M,k as D,w as T,n as I,g as O,F as A,i as ge,p as fe,m as he,K as _e,L as X,z as q}from"./index-52426927.js";import{D as R}from"./vuedraggable.umd-ab7c1c56.js";import{g as ye}from"./ComponentService-0627c48c.js";import{_ as $e}from"./Group.vue_vue_type_script_setup_true_lang-95f483a0.js";import{a as Ce,u as ke,b as we}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-b65c66dd.js";import{u as Q}from"./ResourceService-a7bc3636.js";import{b as Se,e as W}from"./PageService-14026755.js";const Te=["onMousedown"],Ie=L({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const n=e,o=k(500),i=P(()=>`position-${n.position}-0`),r=P(()=>{switch(n.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),u=a=>{const s=a.clientX,l=o.value,c=y=>{const U=n.position==="left"?l+(y.clientX-s):l-(y.clientX-s);o.value=U<200?200:U},g=()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",g)};window.addEventListener("mousemove",c),window.addEventListener("mouseup",g)};return(a,s)=>{const l=V("fa-icon");return p(),f("div",{style:be({width:e.canResize&&!e.isInvisible?`${o.value}px`:`${["left","right"].includes(e.position)?"initial":"100%"}`}),class:C(["float-toolbar",r.value,i.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:C(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:C(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:C(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[ve(a.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:C(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":e.position==="top","float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right"}])},[t("button",{class:C(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:s[0]||(s[0]=c=>a.$emit("update:isInvisible",!e.isInvisible))},[d(l,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),F(" "+v(e.isInvisible?e.showLabel||a.$t("buttons.show"):e.hiddeLabel||a.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(p(),f("div",{key:0,class:"border-l-2 border-l-gray-200 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:K(u,["prevent","stop"])},null,40,Te)):S("",!0)],6)}}});const Y=M(Ie,[["__scopeId","data-v-4b1b3a7f"]]),Ve={class:"toolbar-container"},Le={class:"toolbar-actions"},Ue={type:"submit",class:"button-link"},ze={class:"title"},De=["href"],Fe={class:"toolbar-route"},Ee={class:"toolbar-route-input"},Me={class:"label"},Pe=["value","placeholder"],Be={class:"toolbar-route-input"},Re={class:"label"},Oe=["value","placeholder"],Ae={class:"toolbar-route-input"},Ne={class:"label"},je=["value","placeholder"],He=L({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const n=k(!0);return(o,i)=>{const r=V("fa-icon"),u=V("router-link");return p(),D(Y,{isInvisible:n.value,"onUpdate:isInvisible":i[4]||(i[4]=a=>n.value=a),showLabel:o.$t("pages.buttons.settings")},{default:T(()=>[t("div",Ve,[t("div",Le,[d(u,{class:"button-link",to:{name:"pages.index"}},{default:T(()=>[d(r,{icon:"arrow-left"}),F(" "+v(o.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(p(),f("button",{key:0,onClick:i[0]||(i[0]=a=>o.$emit("delete")),type:"button",class:"button-link danger"},v(o.$t("buttons.delete")),1)):S("",!0),t("button",Ue,v(o.$t("buttons.save")),1),t("h1",ze,[F(v(e.title)+" ",1),e.showDelete?(p(),f("a",{key:0,href:e.url,target:"_blank"},[d(r,{icon:"external-link-alt"})],8,De)):S("",!0)])]),t("div",Fe,[t("div",Ee,[t("label",Me,v(o.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:i[1]||(i[1]=a=>o.$emit("update:name",I(H)(a.target))),placeholder:o.$t("pages.placeholders.pageName")},null,40,Pe)]),t("div",Be,[t("label",Re,v(o.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:i[2]||(i[2]=a=>o.$emit("update:pageTitle",I(de)(a.target))),placeholder:o.$t("pages.placeholders.pageTitle")},null,40,Oe)]),t("div",Ae,[t("label",Ne,v(o.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:i[3]||(i[3]=a=>o.$emit("update:url",I(H)(a.target))),placeholder:o.$t("pages.placeholders.pageUrl")},null,40,je)])])])]),_:1},8,["isInvisible","showLabel"])}}});const Pt=M(He,[["__scopeId","data-v-e5b92884"]]),Xe={class:"tile h-24 cursor-pointer"},qe={class:"tile-title cursor-grab active:cursor-grabbing"},We=L({__name:"AvailableComponents",setup(e){const n=k([]),o=P(()=>pe(n.value)),i=k(!1),r=a=>{const s={};a.variables.forEach(c=>{s[c.name]=null});const l={id:a.id||1+1,...a,variables:a.variables.map(c=>({...c})),content:s};return delete l.content_id,l},u=()=>{i.value=!0,ye({withData:!0}).then(a=>{n.value=a.data.data}).finally(()=>{i.value=!1})};return O(()=>{u()}),(a,s)=>{const l=V("fa-icon");return p(),f(A,null,[t("button",{onClick:u,type:"button",class:"button secondary"},[d(l,{icon:"sync",class:C({"animate-spin":i.value})},null,8,["class"]),F(" "+v(a.$t("components.buttons.refresh")),1)]),d($e,{items:o.value},{default:T(c=>[d(I(R),{class:"grid grid-cols-2 gap-4",modelValue:c.item,"onUpdate:modelValue":g=>c.item=g,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:r,"item-key":"id"},{item:T(({element:g})=>[t("div",Xe,[t("label",qe,v(I(me)(g.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])],64)}}}),{resourceFromId:Ge}=Q(),G=e=>typeof e=="string"?e==null?void 0:e.toString():"",Je=e=>(typeof e=="number"||typeof e=="string")&&Ge(+e).url||"",Ke=e=>{if(typeof e!="number"||typeof e!="string"){const n=e;return n.rows.reduce((o,i)=>{const r=n.columns.reduce((u,a)=>{const s=i.find(g=>g.name===a.name),l=(s==null?void 0:s.value)||(s==null?void 0:s.default);if(!s||!l)return u;const c=Z(s==null?void 0:s.type,l);return u[a.name]=c,u},{});return[...o,r]},[])}return[]},Z=(e,n)=>{switch(e){case"text":return G(n);case"resource":return Je(n);case"datatable":return Ke(n);case"textarea":return G(n);default:return""}},x=(e,n)=>e.variables.reduce((i,r)=>{var s;const u=n&&n[r.name]?n[r.name]:(s=e.variables.find(l=>l.name===r.name))==null?void 0:s.default,a=u?Z(r.type,u):"";return i[r.name]=a,i},{});class Qe{constructor(){B(this,"component");B(this,"subscribedComponents",{})}subscribe(n,o){n.id&&(this.subscribedComponents[n.id]=o)}attach(n){this.component=n}detach(){this.component=void 0}update(){var n,o,i;this.component&&this.component.id&&((i=(o=this.subscribedComponents)[this.component.id])==null||i.call(o,x(this.component,(n=this.component)==null?void 0:n.content)||{}))}}const Ye=new Qe,N=()=>Ye,Ze={key:0,class:"component-configuration-parameters"},xe={class:"component-configuration-label"},et=L({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:n}){const o=N(),i=(u,a)=>{u.content&&(u.content[a]=null)},r=()=>{o.update()};return(u,a)=>{const s=V("fa-icon");return e.component?(p(),f("div",Ze,[(p(!0),f(A,null,ge(e.component.variables,l=>(p(),f("div",{key:l.name},[t("div",xe,[t("label",null,v(l.name)+":",1),d(s,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:c=>i(e.component,l.name)},null,8,["onClick"])]),e.component.content?(p(),D(Ce,{key:0,editStructure:!1,modelValue:e.component.content[l.name],"onUpdate:modelValue":[c=>e.component.content[l.name]=c,r],"default-value":l.default,name:l.name,type:l.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)}}});const tt=M(et,[["__scopeId","data-v-8aa60c2a"]]),ot=e=>(fe("data-v-e8ede51d"),e=e(),he(),e),nt=ot(()=>t("hr",null,null,-1)),st=L({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(n,o)=>{const i=V("fa-icon");return p(),f("button",{class:"page-sections-buttons-add",onClick:o[0]||(o[0]=K(r=>n.$emit("click"),["stop"])),type:"button"},[nt,t("span",null,[d(i,{icon:"square-plus"}),F(" "+v(n.$t("pages.buttons.addSection")),1)])])}}});const J=M(st,[["__scopeId","data-v-e8ede51d"]]),it={class:"relative"},at=t("div",{class:"absolute inset-0"},null,-1),lt=L({__name:"ComponentPreview",props:{component:{type:Object,required:!0}},setup(e){const n=N(),o=e,i=k(null),r=async s=>{if(!o.component.id)return;const l=await Se(o.component.id,s);if(i.value){const c=i.value.contentDocument;if(!c)return;const[g,y]=a();c.open(),c.write(l.data),c.head.appendChild(g),c.body.appendChild(y),c.close(),i.value.onload=()=>{const U=c.body.scrollHeight;i.value&&(i.value.style.height=`${U}px`)}}},u=()=>{if(i.value){const s=i.value.contentDocument;if(!s)return;const l=s.body.offsetHeight;i.value.style.height=`${l}px`}},a=()=>{const s=document.createElement("link"),l=document.createElement("script"),c=W("style"),g=W("script");return s.rel="stylesheet",s.href=c,l.src=g,l.async=!0,[s,l]};return O(()=>{r(x(o.component,o.component.content)),n.subscribe(o.component,s=>{r(s).then(()=>u())})}),(s,l)=>(p(),f("div",it,[t("iframe",{class:"w-screen",ref_key:"iframe",ref:i,sandbox:"allow-scripts allow-same-origin"},null,512),at]))}}),ct={class:"w-full p-4 h-screen flex flex-col overflow-y-auto"},rt={class:"form-group"},ut={class:"page-sections-container"},dt={class:"page-sections-content"},pt={class:"page-sections-item-panel"},mt={class:"page-sections-preview"},vt={class:"page-sections-preview-content"},bt={class:"page-sections-item-buttons"},gt={class:"page-sections-components-grip-lines"},ft={class:"pages-secttions-component-buttons"},ht=["onClick"],_t=["onClick"],yt={class:"page-sections-label"},$t={class:"hideable-header"},Ct={class:"page-sections-buttons"},kt={key:1},wt={key:2},St=["onClick"],Tt=L({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:1,components:[]}]},pageEditionMode:{type:String,default:"adding-component"}},emits:["update:sections"],setup(e,{emit:n}){const{loadResources:o}=Q(),{loadSources:i}=ke(),{loadActions:r}=we(),u=N(),a=e,s=k(!0),l=n,c=k(null),g=k(null),y=k("adding-component"),U=m=>{const b=[...a.sections];b.splice(m,0,X({order:0,components:[]})),l("update:sections",b)},ee=()=>{l("update:sections",[...a.sections,X({order:0,components:[]})])},te=m=>{const b=[...a.sections];b.splice(m,1),l("update:sections",b)},oe=(m,b)=>{m.splice(b,1)},ne=(m,b)=>{s.value=!1,y.value="editing-component",c.value=m,g.value=b,u.attach(m)},se=()=>{s.value=!0,y.value="adding-component",u.detach(),c.value=null,g.value=null},ie=(m,b)=>{var _,E;return((_=c.value)==null?void 0:_.id)===m.id&&m.order===((E=c.value)==null?void 0:E.order)&&g.value===b},z=k("left"),ae=()=>{z.value=z.value==="left"?"right":"left"},le=P(()=>y.value==="adding-component"?"availableComponents":"componentConfigurationForm");return O(()=>{o(),i(),r()}),(m,b)=>{const _=V("fa-icon"),E=_e("autosize");return p(),f(A,null,[d(Y,{isInvisible:s.value,"onUpdate:isInvisible":b[1]||(b[1]=$=>s.value=$),position:z.value,showLabel:m.$t("pages.buttons.components"),canResize:!0},{default:T(()=>[t("div",ct,[t("div",{class:C(`component-configuration-title ${z.value}`)},[t("h2",null,v(m.$t(`pages.titles.${le.value}`)),1),t("div",null,[t("div",rt,[t("button",{type:"button",class:"button small default",onClick:se},v(m.$t("pages.buttons.exit")),1),t("button",{type:"button",class:"button small default button-position",onClick:ae},[d(_,{icon:"border-top-left"})])])])],2),y.value==="adding-component"?(p(),D(We,{key:0})):S("",!0),y.value==="editing-component"?(p(),D(tt,{key:1,position:z.value,"onUpdate:position":b[0]||(b[0]=$=>z.value=$),component:c.value},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",ut,[t("div",dt,[d(I(R),{list:e.sections,class:"page-sections-panel",onInput:b[2]||(b[2]=$=>m.$emit("update:sections",$)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:T(({element:$,index:h})=>[t("div",{class:C(["page-sections-list-content",{"page-sections-list-header":!h,"page-sections-list-footer":h===e.sections.length-1}])},[h?(p(),D(J,{key:0,onClick:w=>U(h)},null,8,["onClick"])):S("",!0),t("div",pt,[d(I(R),{class:"page-sections-dreaggable",modelValue:$.components,"onUpdate:modelValue":w=>$.components=w,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:T(({element:w,index:j})=>[t("div",{class:C(["page-sections-item",{"page-sections-item-selected":ie(w,h)}])},[q((p(),f("div",mt,[q((p(),f("div",vt,[d(lt,{component:w},null,8,["component"])])),[[E]]),t("div",bt,[t("button",gt,[d(_,{icon:"grip"})]),t("div",ft,[t("button",{type:"button",onClick:ce=>oe($.components,j)},[d(_,{icon:"trash"})],8,ht),t("button",{type:"button",onClick:ce=>ne(w,h)},[d(_,{icon:"file-invoice"})],8,_t),t("span",yt,v(m.$t("pages.labels.component"))+" "+v((w.order=j)+1)+" - "+v(w.name),1)])])])),[[E]])],2)]),header:T(()=>[t("div",$t,[d(_,{icon:"triangle-exclamation"}),t("p",null,v(m.$t("pages.labels.addComponentsToSection",{section:h})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("div",Ct,[h&&h!==e.sections.length-1?(p(),D(_,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),h?(p(),f("span",wt,v(m.$t(h===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:$.order=h})),1)):(p(),f("span",kt,[d(_,{icon:"heading"}),F(" "+v(m.$t("pages.labels.header")),1)])),t("button",{onClick:w=>te(h)},[d(_,{icon:"trash"})],8,St)])])],2)]),_:1},8,["list"]),d(J,{onClick:ee})])])],64)}}});const Bt=M(Tt,[["__scopeId","data-v-1725acc5"]]);export{Pt as P,Bt as a};
