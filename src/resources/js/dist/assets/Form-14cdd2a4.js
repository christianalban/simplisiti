var pe=Object.defineProperty;var me=(e,o,n)=>o in e?pe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var A=(e,o,n)=>(me(e,typeof o!="symbol"?o+"":o,n),n);import{i as ee,v as G,b as ve,g as be,c as ge}from"./helpers-73a2380c.js";import{d as L,e as _,f as R,r as V,o as d,c as h,h as t,y as k,I as fe,a as m,j as D,t as b,v as te,l as w,J as he,_ as B,k as M,w as T,n as I,g as j,F as H,i as ye,p as _e,m as $e,K as Ce,L as J,z as K}from"./index-021f3fa9.js";import{D as N}from"./vuedraggable.umd-b7ff37ab.js";import{g as ke}from"./ComponentService-36e8d3ea.js";import{_ as we}from"./Group.vue_vue_type_script_setup_true_lang-ceaffc0f.js";import{a as Se,u as Te,b as Ie}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-a4860216.js";import{u as oe}from"./ResourceService-c9d16174.js";import{b as Ve,e as Q,f as Y}from"./PageService-b2d27b19.js";const Le=["onMousedown"],Ue=L({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const o=e,n=_(500),i=_(ee()),u=R(()=>`position-${o.position}-0`),p=R(()=>{switch(o.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),l=s=>{const a=s.clientX,r=n.value,f=P=>{const z=o.position==="left"?r+(P.clientX-a):r-(P.clientX-a);n.value=z<200?200:z},U=()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",U)};window.addEventListener("mousemove",f),window.addEventListener("mouseup",U)},c=R(()=>i.value?"100%":o.canResize&&!o.isInvisible?`${n.value}px`:`${["left","right"].includes(o.position)?"initial":"100%"}`);return(s,a)=>{const r=V("fa-icon");return d(),h("div",{style:he({width:c.value}),class:k(["float-toolbar",p.value,u.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[fe(s.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:k(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":["top","bottom"].includes(e.position),"float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right",bottom:e.position==="bottom",top:e.position==="top"}])},[t("button",{class:k(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:a[0]||(a[0]=f=>s.$emit("update:isInvisible",!e.isInvisible))},[m(r,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),D(" "+b(e.isInvisible?e.showLabel||s.$t("buttons.show"):e.hiddeLabel||s.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(d(),h("div",{key:0,class:"border-l-2 border-l-gray-200 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:te(l,["prevent","stop"])},null,40,Le)):w("",!0)],6)}}});const ne=B(Ue,[["__scopeId","data-v-a5e17105"]]),Pe={class:"toolbar-container"},ze={class:"toolbar-actions"},Ee={class:"flex gap-2"},Me={type:"submit",class:"button primary"},De={class:"title"},Fe=["href"],Re={class:"toolbar-route"},Be={class:"toolbar-route-input"},Oe={class:"label"},Ae=["value","placeholder"],Ne={class:"toolbar-route-input"},je={class:"label"},He=["value","placeholder"],We={class:"toolbar-route-input"},Xe={class:"label"},qe=["value","placeholder"],Ge=L({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const o=_(!0);return(n,i)=>{const u=V("fa-icon"),p=V("router-link");return d(),M(ne,{isInvisible:o.value,"onUpdate:isInvisible":i[4]||(i[4]=l=>o.value=l),showLabel:n.$t("pages.buttons.settings")},{default:T(()=>[t("div",Pe,[t("div",ze,[t("div",Ee,[m(p,{class:"button secondary",to:{name:"pages.index"}},{default:T(()=>[m(u,{icon:"arrow-left"}),D(" "+b(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(d(),h("button",{key:0,onClick:i[0]||(i[0]=l=>n.$emit("delete")),type:"button",class:"button danger"},b(n.$t("buttons.delete")),1)):w("",!0),t("button",Me,b(n.$t("buttons.save")),1)]),t("h1",De,[D(b(e.title)+" ",1),e.showDelete?(d(),h("a",{key:0,href:e.url,target:"_blank"},[m(u,{icon:"external-link-alt"})],8,Fe)):w("",!0)])]),t("div",Re,[t("div",Be,[t("label",Oe,b(n.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:i[1]||(i[1]=l=>n.$emit("update:name",I(G)(l.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,Ae)]),t("div",Ne,[t("label",je,b(n.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:i[2]||(i[2]=l=>n.$emit("update:pageTitle",I(ve)(l.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,He)]),t("div",We,[t("label",Xe,b(n.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:i[3]||(i[3]=l=>n.$emit("update:url",I(G)(l.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,qe)])])])]),_:1},8,["isInvisible","showLabel"])}}});const Nt=B(Ge,[["__scopeId","data-v-6a5b1085"]]),Je={class:"overflow-y-auto mt-2"},Ke={class:"tile h-24 cursor-pointer"},Qe={class:"tile-title cursor-grab active:cursor-grabbing"},Ye=L({__name:"AvailableComponents",setup(e){const o=_([]),n=R(()=>be(o.value)),i=_(!1),u=l=>{const c={};l.variables.forEach(a=>{c[a.name]=null});const s={id:l.id||1+1,...l,variables:l.variables.map(a=>({...a})),content:c};return delete s.content_id,s},p=()=>{i.value=!0,ke({withData:!0}).then(l=>{o.value=l.data.data}).finally(()=>{i.value=!1})};return j(()=>{p()}),(l,c)=>{const s=V("fa-icon");return d(),h(H,null,[t("button",{onClick:p,type:"button",class:"button secondary"},[m(s,{icon:"sync",class:k({"animate-spin":i.value})},null,8,["class"]),D(" "+b(l.$t("components.buttons.refresh")),1)]),t("div",Je,[m(we,{items:n.value},{default:T(a=>[m(I(N),{class:"grid grid-cols-2 gap-4",modelValue:a.item,"onUpdate:modelValue":r=>a.item=r,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:u,"item-key":"id"},{item:T(({element:r})=>[t("div",Ke,[t("label",Qe,b(I(ge)(r.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])])],64)}}}),{resourceFromId:Ze}=oe(),Z=e=>typeof e=="string"?e==null?void 0:e.toString():"",xe=e=>(typeof e=="number"||typeof e=="string")&&Ze(+e).url||"",et=e=>{if(typeof e!="number"||typeof e!="string"){const o=e;return o.rows.reduce((n,i)=>{const u=o.columns.reduce((p,l)=>{const c=i.find(r=>r.name===l.name),s=(c==null?void 0:c.value)||(c==null?void 0:c.default),a=!(c!=null&&c.type)||!s?null:se(c==null?void 0:c.type,s);return p[l.name]=a,p},{});return[...n,u]},[])}return[]},se=(e,o)=>{switch(e){case"text":return Z(o);case"resource":return xe(o);case"datatable":return et(o);case"textarea":return Z(o);default:return""}},ie=(e,o)=>e.variables.reduce((i,u)=>{var c;const p=o&&o[u.name]?o[u.name]:(c=e.variables.find(s=>s.name===u.name))==null?void 0:c.default,l=p?se(u.type,p):"";return i[u.name]=l,i},{});class tt{constructor(){A(this,"component");A(this,"subscribedComponents",{})}subscribe(o,n){o.id&&(this.subscribedComponents[o.id]=n)}attach(o){this.component=o}detach(){this.component=void 0}update(){var o,n,i;this.component&&this.component.id&&((i=(n=this.subscribedComponents)[this.component.id])==null||i.call(n,ie(this.component,(o=this.component)==null?void 0:o.content)||{}))}}const ot=new tt,W=()=>ot,nt={key:0,class:"component-configuration-parameters"},st={class:"component-configuration-label"},it=L({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:o}){const n=W(),i=(p,l)=>{p.content&&(p.content[l]=null)},u=()=>{n.update()};return(p,l)=>{const c=V("fa-icon");return e.component?(d(),h("div",nt,[(d(!0),h(H,null,ye(e.component.variables,s=>(d(),h("div",{key:s.name},[t("div",st,[t("label",null,b(s.name)+":",1),m(c,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:a=>i(e.component,s.name)},null,8,["onClick"])]),e.component.content?(d(),M(Se,{key:0,editStructure:!1,modelValue:e.component.content[s.name],"onUpdate:modelValue":[a=>e.component.content[s.name]=a,u],"default-value":s.default,name:s.name,type:s.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):w("",!0)]))),128))])):w("",!0)}}});const at=B(it,[["__scopeId","data-v-8aa60c2a"]]),lt=e=>(_e("data-v-e8ede51d"),e=e(),$e(),e),ct=lt(()=>t("hr",null,null,-1)),rt=L({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(o,n)=>{const i=V("fa-icon");return d(),h("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=te(u=>o.$emit("click"),["stop"])),type:"button"},[ct,t("span",null,[m(i,{icon:"square-plus"}),D(" "+b(o.$t("pages.buttons.addSection")),1)])])}}});const x=B(rt,[["__scopeId","data-v-e8ede51d"]]),ut={class:"relative"},dt=t("div",{class:"absolute inset-0"},null,-1),pt=L({__name:"ComponentPreview",props:{component:{type:Object,required:!0}},setup(e){const o=W(),n=e,i=_(null),u=async s=>{if(!n.component.id)return;const a=await Ve(n.component.id,s);if(i.value){const r=i.value.contentDocument;if(!r)return;const[f,U]=l(),[P,z]=c();r.open(),r.write(a.data),r.head.appendChild(f),r.head.appendChild(P),r.body.appendChild(U),r.body.appendChild(z),r.close(),i.value.onload=()=>{const O=r.body.scrollHeight;i.value&&(i.value.style.height=`${O}px`)}}},p=()=>{if(i.value){const s=i.value.contentDocument;if(!s)return;const a=s.body.offsetHeight;i.value.style.height=`${a}px`}},l=()=>{const s=document.createElement("link"),a=document.createElement("script"),r=Q("style"),f=Q("script");return s.rel="stylesheet",s.href=r,a.src=f,a.async=!0,[s,a]},c=()=>{const s=document.createElement("link"),a=document.createElement("script"),r=Y("style"),f=Y("script");return s.rel="stylesheet",s.href=r,a.src=f,a.async=!0,[s,a]};return j(()=>{u(ie(n.component,n.component.content)),o.subscribe(n.component,s=>{u(s).then(()=>p())})}),(s,a)=>(d(),h("div",ut,[t("iframe",{class:"w-screen",ref_key:"iframe",ref:i,sandbox:"allow-scripts allow-same-origin"},null,512),dt]))}}),mt={class:"w-full p-4 flex flex-col overflow-y-auto h-[60vh] md:h-full"},vt={class:"form-group"},bt={class:"page-sections-container"},gt={class:"page-sections-content"},ft={class:"page-sections-item-panel"},ht={class:"page-sections-preview"},yt={class:"page-sections-preview-content"},_t={class:"page-sections-item-buttons"},$t={class:"page-sections-components-grip-lines"},Ct={class:"pages-secttions-component-buttons"},kt=["onClick"],wt=["onClick"],St={class:"page-sections-label"},Tt={class:"hideable-header"},It={class:"page-sections-buttons"},Vt={key:1},Lt={key:2},Ut=["onClick"],Pt=L({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:1,components:[]}]},pageEditionMode:{type:String,default:"adding-component"}},emits:["update:sections"],setup(e,{emit:o}){const{loadResources:n}=oe(),{loadSources:i}=Te(),{loadActions:u}=Ie(),p=W(),l=e,c=_(!0),s=o,a=_(null),r=_(null),f=_("adding-component"),U=v=>{const g=[...l.sections];g.splice(v,0,J({order:0,components:[]})),s("update:sections",g)},P=()=>{s("update:sections",[...l.sections,J({order:0,components:[]})])},z=v=>{const g=[...l.sections];g.splice(v,1),s("update:sections",g)},O=(v,g)=>{v.splice(g,1)},ae=(v,g)=>{c.value=!1,f.value="editing-component",a.value=v,r.value=g,p.attach(v)},le=()=>{c.value=!0,f.value="adding-component",p.detach(),a.value=null,r.value=null},ce=(v,g)=>{var $,F;return(($=a.value)==null?void 0:$.id)===v.id&&v.order===((F=a.value)==null?void 0:F.order)&&r.value===g},X=_(ee()),E=_(X.value?"bottom":"left"),re=()=>{E.value=E.value==="left"?"right":"left"},ue=R(()=>f.value==="adding-component"?"availableComponents":"componentConfigurationForm");return j(()=>{n(),i(),u()}),(v,g)=>{const $=V("fa-icon"),F=Ce("autosize");return d(),h(H,null,[m(ne,{isInvisible:c.value,"onUpdate:isInvisible":g[1]||(g[1]=C=>c.value=C),position:E.value,showLabel:v.$t(f.value==="editing-component"?"pages.buttons.settings":"pages.buttons.components"),canResize:!0},{default:T(()=>[t("div",mt,[t("div",{class:k(`component-configuration-title ${E.value}`)},[t("h2",null,b(v.$t(`pages.titles.${ue.value}`)),1),t("div",null,[t("div",vt,[t("button",{type:"button",class:"button small default",onClick:le},b(v.$t("pages.buttons.exit")),1),X.value?w("",!0):(d(),h("button",{key:0,type:"button",class:"button small default button-position",onClick:re},[m($,{icon:"border-top-left"})]))])])],2),f.value==="adding-component"?(d(),M(Ye,{key:0})):w("",!0),f.value==="editing-component"?(d(),M(at,{key:1,position:E.value,"onUpdate:position":g[0]||(g[0]=C=>E.value=C),component:a.value},null,8,["position","component"])):w("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",bt,[t("div",gt,[m(I(N),{list:e.sections,class:"page-sections-panel",onInput:g[2]||(g[2]=C=>v.$emit("update:sections",C)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:T(({element:C,index:y})=>[t("div",{class:k(["page-sections-list-content",{"page-sections-list-header":!y,"page-sections-list-footer":y===e.sections.length-1}])},[y?(d(),M(x,{key:0,onClick:S=>U(y)},null,8,["onClick"])):w("",!0),t("div",ft,[m(I(N),{class:"page-sections-dreaggable",modelValue:C.components,"onUpdate:modelValue":S=>C.components=S,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:T(({element:S,index:q})=>[t("div",{class:k(["page-sections-item",{"page-sections-item-selected":ce(S,y)}])},[K((d(),h("div",ht,[K((d(),h("div",yt,[m(pt,{component:S},null,8,["component"])])),[[F]]),t("div",_t,[t("button",$t,[m($,{icon:"grip"})]),t("div",Ct,[t("button",{type:"button",onClick:de=>O(C.components,q)},[m($,{icon:"trash"})],8,kt),t("button",{type:"button",onClick:de=>ae(S,y)},[m($,{icon:"file-invoice"})],8,wt),t("span",St,b(v.$t("pages.labels.component"))+" "+b((S.order=q)+1)+" - "+b(S.name),1)])])])),[[F]])],2)]),header:T(()=>[t("div",Tt,[m($,{icon:"triangle-exclamation"}),t("p",null,b(v.$t("pages.labels.addComponentsToSection",{section:y})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("div",It,[y&&y!==e.sections.length-1?(d(),M($,{key:0,icon:"grip",class:"page-sections-grip-lines"})):w("",!0),y?(d(),h("span",Lt,b(v.$t(y===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:C.order=y})),1)):(d(),h("span",Vt,[m($,{icon:"heading"}),D(" "+b(v.$t("pages.labels.header")),1)])),t("button",{onClick:S=>z(y)},[m($,{icon:"trash"})],8,Ut)])])],2)]),_:1},8,["list"]),m(x,{onClick:P})])])],64)}}});const jt=B(Pt,[["__scopeId","data-v-bb269b3b"]]);export{Nt as P,jt as a};
