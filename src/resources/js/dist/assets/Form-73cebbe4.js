import{v as O,i as x,g as ee,c as te}from"./helpers-598837fa.js";import{d as T,e as A,r as F,o as r,c as f,g as t,D as k,E as oe,a as m,i as U,t as u,_ as P,b as C,j as V,w,k as S,l as I,f as z,F as B,h as ne,n as se,G as ie,H as ae,A as le,I as ce,J as R,q as H}from"./index-ce9e0ef5.js";import{D as M}from"./vuedraggable.umd-9e8bd957.js";import{g as re,b as ue}from"./ComponentService-0040659d.js";import{_ as de}from"./Group.vue_vue_type_script_setup_true_lang-546cc935.js";import{a as pe}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-d246de00.js";import{u as G}from"./ResourceService-2eabafdb.js";import{b as me}from"./PageService-b03e0bd7.js";const ge=T({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String}},emits:["update:isInvisible"],setup(e){const l=e,n=A(()=>`position-${l.position}-0`),a=A(()=>{switch(l.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}});return(i,c)=>{const o=F("fa-icon");return r(),f("div",{class:k(["float-toolbar",a.value,n.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:k(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[oe(i.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:k(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":e.position==="top","float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right"}])},[t("button",{class:k(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:c[0]||(c[0]=d=>i.$emit("update:isInvisible",!e.isInvisible))},[m(o,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),U(" "+u(e.isInvisible?e.showLabel||i.$t("buttons.show"):e.hiddeLabel||i.$t("buttons.hide")),1)],2)],2)],2)],2)}}});const J=P(ge,[["__scopeId","data-v-f23dbdce"]]),be={class:"toolbar-container"},fe={class:"toolbar-actions"},ve={type:"submit",class:"button-link"},he={class:"title"},_e=["href"],$e={class:"toolbar-route"},ye={class:"toolbar-route-input"},ke={class:"label"},Ce=["value","placeholder"],we={class:"toolbar-route-input"},Se={class:"label"},Ie=["value","placeholder"],Te={class:"toolbar-route-input"},Ve={class:"label"},Fe=["value","placeholder"],De=T({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const l=C(!0);return(n,a)=>{const i=F("fa-icon"),c=F("router-link");return r(),V(J,{isInvisible:l.value,"onUpdate:isInvisible":a[4]||(a[4]=o=>l.value=o),showLabel:n.$t("pages.buttons.settings")},{default:w(()=>[t("div",be,[t("div",fe,[m(c,{class:"button-link",to:{name:"pages.index"}},{default:w(()=>[m(i,{icon:"arrow-left"}),U(" "+u(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(r(),f("button",{key:0,onClick:a[0]||(a[0]=o=>n.$emit("delete")),type:"button",class:"button-link danger"},u(n.$t("buttons.delete")),1)):S("",!0),t("button",ve,u(n.$t("buttons.save")),1),t("h1",he,[U(u(e.title)+" ",1),e.showDelete?(r(),f("a",{key:0,href:e.url,target:"_blank"},[m(i,{icon:"external-link-alt"})],8,_e)):S("",!0)])]),t("div",$e,[t("div",ye,[t("label",ke,u(n.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:a[1]||(a[1]=o=>n.$emit("update:name",I(O)(o.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,Ce)]),t("div",we,[t("label",Se,u(n.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:a[2]||(a[2]=o=>n.$emit("update:pageTitle",I(x)(o.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,Ie)]),t("div",Te,[t("label",Ve,u(n.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:a[3]||(a[3]=o=>n.$emit("update:url",I(O)(o.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,Fe)])])])]),_:1},8,["isInvisible","showLabel"])}}});const _t=P(De,[["__scopeId","data-v-e5b92884"]]),Ue={class:"font-bold"},Pe={class:"tile h-24 cursor-pointer"},Le={class:"tile-title cursor-grab active:cursor-grabbing"},Be=T({__name:"AvailableComponents",setup(e){const l=C([]),n=A(()=>ee(l.value)),a=i=>{const c={};i.variables.forEach(d=>{c[d.name]=null});const o={id:i.id||1+1,...i,variables:i.variables.map(d=>({...d})),content:c};return delete o.content_id,o};return z(()=>{re().then(i=>{l.value=i.data.data})}),(i,c)=>(r(),f(B,null,[t("h2",Ue,u(i.$t("pages.titles.availableComponents")),1),m(de,{items:n.value},{default:w(o=>[m(I(M),{class:"grid grid-cols-2 gap-4",modelValue:o.item,"onUpdate:modelValue":d=>o.item=d,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:a,"item-key":"id"},{item:w(({element:d})=>[t("div",Pe,[t("label",Le,u(I(te)(d.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])],64))}}),Ee={class:"form-group"},Ne={key:0,class:"component-configuration-parameters"},Ae={class:"component-configuration-label"},Me=T({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["exit","update:position"],setup(e,{emit:l}){const n=e,a=l,i=()=>{const o=n.position==="left"?"right":"left";a("update:position",o)},c=(o,d)=>{o.content&&(o.content[d]=null)};return(o,d)=>{const _=F("fa-icon");return r(),f(B,null,[t("div",{class:k(`component-configuration-title ${e.position}`)},[t("h2",null,u(o.$t("pages.titles.componentConfigurationForm")),1),t("div",null,[t("div",Ee,[t("button",{type:"button",class:"button small default",onClick:d[0]||(d[0]=v=>o.$emit("exit"))},u(o.$t("pages.buttons.exit")),1),t("button",{type:"button",class:"button small default button-position",onClick:i},[m(_,{icon:"border-top-left"})])])])],2),e.component?(r(),f("div",Ne,[(r(!0),f(B,null,ne(e.component.variables,v=>(r(),f("div",{key:v.name},[t("div",Ae,[t("label",null,u(v.name)+":",1),m(_,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:L=>c(e.component,v.name)},null,8,["onClick"])]),e.component.content?(r(),V(pe,{key:0,modelValue:e.component.content[v.name],"onUpdate:modelValue":L=>e.component.content[v.name]=L,"default-value":v.default,name:v.name,type:v.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)],64)}}});const ze=P(Me,[["__scopeId","data-v-2c350eb3"]]),Oe=e=>(ie("data-v-e8ede51d"),e=e(),ae(),e),Re=Oe(()=>t("hr",null,null,-1)),He=T({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(l,n)=>{const a=F("fa-icon");return r(),f("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=se(i=>l.$emit("click"),["stop"])),type:"button"},[Re,t("span",null,[m(a,{icon:"square-plus"}),U(" "+u(l.$t("pages.buttons.addSection")),1)])])}}});const q=P(He,[["__scopeId","data-v-e8ede51d"]]),{resourceFromId:qe}=G(),j=e=>typeof e=="string"?e:"",je=e=>(typeof e=="number"||typeof e=="string")&&qe(+e).url||"",Ge=(e,l)=>{switch(e){case"text":return j(l);case"resource":return je(l);case"datatable":return l;case"textarea":return j(l);default:return""}},Je=T({__name:"SectionPreview",props:{content:{type:String,default:""}},setup(e){const l=e,n=C(null),a=c=>{if(n.value){const o=n.value.contentDocument;if(!o)return;const d=i();o.open(),o.write(c),o.head.appendChild(d),o.close(),setTimeout(()=>{const _=o.body.firstChild,v=_==null?void 0:_.clientHeight;n.value&&(n.value.style.height=`${v}px`)},1e3)}},i=()=>{const c=document.createElement("link"),o=me("style");return c.rel="stylesheet",c.href=o,c};return le(()=>l.content,c=>{a(c)}),z(()=>{a(l.content)}),(c,o)=>(r(),f("iframe",{class:"w-screen",ref_key:"iframe",ref:n},null,512))}}),Ke={class:"w-[30vw] p-4 h-screen flex flex-col overflow-y-auto"},Qe={class:"page-sections-container"},We={class:"page-sections-content"},Xe={class:"page-sections-item-panel"},Ye={class:"page-sections-preview"},Ze={class:"page-sections-preview-content"},xe={class:"page-sections-item-buttons"},et={class:"page-sections-components-grip-lines"},tt={class:"pages-secttions-component-buttons"},ot=["onClick"],nt=["onClick"],st={class:"page-sections-label"},it={class:"hideable-header"},at={class:"page-sections-buttons"},lt={key:1},ct={key:2},rt=["onClick"],ut=T({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:0,components:[]}]}},emits:["update:sections"],setup(e,{emit:l}){const{loadResources:n}=G(),a=e,i=C(!0),c=l,o=C(null),d=C(null),_=C("adding-component"),v=s=>{const p=[...a.sections];p.splice(s,0,R({order:0,components:[]})),c("update:sections",p)},L=()=>{c("update:sections",[...a.sections,R({order:0,components:[]})])},K=s=>{const p=[...a.sections];p.splice(s,1),c("update:sections",p)},Q=(s,p)=>{s.splice(p,1)},W=(s,p)=>{i.value=!1,_.value="editing-component",o.value=s,d.value=p},X=()=>{i.value=!0,_.value="adding-component",o.value=null,d.value=null},Y=s=>(s.content=s.content||ue(s),s.variables.reduce(($,y)=>{var D;const b=s.content&&s.content[y.name]?s.content[y.name]:(D=s.variables.find(N=>N.name===y.name))==null?void 0:D.default,g=b?Ge(y.type,b==null?void 0:b.toString()):"";let h="";return typeof g=="string"?h=g:h=JSON.stringify(g),$.replace(`{{ $${y.name} }}`,h||"")},s.html)),Z=(s,p)=>{var $,y;return(($=o.value)==null?void 0:$.id)===s.id&&s.order===((y=o.value)==null?void 0:y.order)&&d.value===p},E=C("left");return z(()=>{n()}),(s,p)=>{const $=F("fa-icon"),y=ce("autosize");return r(),f(B,null,[m(J,{isInvisible:i.value,"onUpdate:isInvisible":p[1]||(p[1]=b=>i.value=b),position:E.value,showLabel:s.$t("pages.buttons.components")},{default:w(()=>[t("div",Ke,[_.value==="adding-component"?(r(),V(Be,{key:0})):S("",!0),_.value==="editing-component"?(r(),V(ze,{key:1,position:E.value,"onUpdate:position":p[0]||(p[0]=b=>E.value=b),component:o.value,onExit:X},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",Qe,[t("div",We,[m(I(M),{list:e.sections,class:"page-sections-panel",onInput:p[2]||(p[2]=b=>s.$emit("update:sections",b)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:w(({element:b,index:g})=>[t("div",{class:k(["page-sections-list-content",{"page-sections-list-header":!g,"page-sections-list-footer":g===e.sections.length-1}])},[g?(r(),V(q,{key:0,onClick:h=>v(g)},null,8,["onClick"])):S("",!0),t("div",Xe,[m(I(M),{class:"page-sections-dreaggable",modelValue:b.components,"onUpdate:modelValue":h=>b.components=h,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:w(({element:h,index:D})=>[t("div",{class:k(["page-sections-item",{"page-sections-item-selected":Z(h,g)}])},[H((r(),f("div",Ye,[H((r(),f("div",Ze,[m(Je,{content:Y(h)},null,8,["content"])])),[[y]]),t("div",xe,[t("button",et,[m($,{icon:"grip"})]),t("div",tt,[t("button",{type:"button",onClick:N=>Q(b.components,D)},[m($,{icon:"trash"})],8,ot),t("button",{type:"button",onClick:N=>W(h,g)},[m($,{icon:"file-invoice"})],8,nt),t("span",st,u(s.$t("pages.labels.component"))+" "+u((h.order=D)+1)+" - "+u(h.name),1)])])])),[[y]])],2)]),header:w(()=>[t("div",it,[t("p",null,u(s.$t("pages.labels.addComponentsToSection",{section:g})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("div",at,[g&&g!==e.sections.length-1?(r(),V($,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),g?(r(),f("span",ct,u(s.$t(g===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:b.order=g})),1)):(r(),f("span",lt,[m($,{icon:"heading"}),U(" "+u(s.$t("pages.labels.header")),1)])),t("button",{onClick:h=>K(g)},[m($,{icon:"trash"})],8,rt)])])],2)]),_:1},8,["list"]),m(q,{onClick:L})])])],64)}}});const $t=P(ut,[["__scopeId","data-v-506485f3"]]);export{_t as P,$t as a};
