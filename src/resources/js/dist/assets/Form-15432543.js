import{v as G,i as se,g as ie,c as le}from"./helpers-ddca868d.js";import{d as E,b as w,e as P,r as T,o as u,c as h,g as o,D as k,E as ae,a as d,i as U,t as p,n as Y,k as S,G as ce,_ as B,j as F,w as V,l as I,f as X,F as j,h as re,H as ue,I as de,A as pe,J as me,K as J,q as x}from"./index-36ec2987.js";import{D as H}from"./vuedraggable.umd-7e2cc98a.js";import{g as ve,b as ge}from"./ComponentService-d7f40fba.js";import{_ as be}from"./Group.vue_vue_type_script_setup_true_lang-5de27bc8.js";import{b as fe,u as he}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-61d6c478.js";import{u as Z}from"./ResourceService-47e9e2eb.js";import{b as K}from"./PageService-b359fac4.js";const _e=["onMousedown"],ye=E({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const i=e,n=w(500),s=P(()=>`position-${i.position}-0`),v=P(()=>{switch(i.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),a=t=>{const c=t.clientX,g=n.value,r=D=>{const R=g+(D.clientX-c);n.value=R<200?200:R},y=()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",y)};window.addEventListener("mousemove",r),window.addEventListener("mouseup",y)};return(t,c)=>{const g=T("fa-icon");return u(),h("div",{style:ce({width:e.canResize&&!e.isInvisible?`${n.value}px`:`${["left","right"].includes(e.position)?"initial":"100%"}`}),class:k(["float-toolbar",v.value,s.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[o("div",{class:k(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[o("div",{class:k(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[o("div",{class:k(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[ae(t.$slots,"default",{},void 0,!0)],2)],2),o("div",{class:k(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":e.position==="top","float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right"}])},[o("button",{class:k(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:c[0]||(c[0]=r=>t.$emit("update:isInvisible",!e.isInvisible))},[d(g,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),U(" "+p(e.isInvisible?e.showLabel||t.$t("buttons.show"):e.hiddeLabel||t.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(u(),h("div",{key:0,class:"border-l-2 border-l-gray-200 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:Y(a,["prevent","stop"])},null,40,_e)):S("",!0)],6)}}});const ee=B(ye,[["__scopeId","data-v-a7437315"]]),$e={class:"toolbar-container"},Ce={class:"toolbar-actions"},ke={type:"submit",class:"button-link"},we={class:"title"},Se=["href"],Ve={class:"toolbar-route"},Ie={class:"toolbar-route-input"},Te={class:"label"},Ee=["value","placeholder"],Re={class:"toolbar-route-input"},Le={class:"label"},Fe=["value","placeholder"],Ue={class:"toolbar-route-input"},De={class:"label"},ze=["value","placeholder"],Be=E({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const i=w(!0);return(n,s)=>{const v=T("fa-icon"),a=T("router-link");return u(),F(ee,{isInvisible:i.value,"onUpdate:isInvisible":s[4]||(s[4]=t=>i.value=t),showLabel:n.$t("pages.buttons.settings")},{default:V(()=>[o("div",$e,[o("div",Ce,[d(a,{class:"button-link",to:{name:"pages.index"}},{default:V(()=>[d(v,{icon:"arrow-left"}),U(" "+p(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(u(),h("button",{key:0,onClick:s[0]||(s[0]=t=>n.$emit("delete")),type:"button",class:"button-link danger"},p(n.$t("buttons.delete")),1)):S("",!0),o("button",ke,p(n.$t("buttons.save")),1),o("h1",we,[U(p(e.title)+" ",1),e.showDelete?(u(),h("a",{key:0,href:e.url,target:"_blank"},[d(v,{icon:"external-link-alt"})],8,Se)):S("",!0)])]),o("div",Ve,[o("div",Ie,[o("label",Te,p(n.$t("pages.labels.pageName")),1),o("input",{class:"input",type:"text",required:"",value:e.name,onInput:s[1]||(s[1]=t=>n.$emit("update:name",I(G)(t.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,Ee)]),o("div",Re,[o("label",Le,p(n.$t("pages.labels.pageTitle")),1),o("input",{class:"input",type:"text",value:e.pageTitle,onInput:s[2]||(s[2]=t=>n.$emit("update:pageTitle",I(se)(t.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,Fe)]),o("div",Ue,[o("label",De,p(n.$t("pages.labels.pageUrl")),1),o("input",{class:"input",type:"text",value:e.url,onInput:s[3]||(s[3]=t=>n.$emit("update:url",I(G)(t.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,ze)])])])]),_:1},8,["isInvisible","showLabel"])}}});const It=B(Be,[["__scopeId","data-v-e5b92884"]]),Me={class:"tile h-24 cursor-pointer"},Pe={class:"tile-title cursor-grab active:cursor-grabbing"},Ae=E({__name:"AvailableComponents",setup(e){const i=w([]),n=P(()=>ie(i.value)),s=w(!1),v=t=>{const c={};t.variables.forEach(r=>{c[r.name]=null});const g={id:t.id||1+1,...t,variables:t.variables.map(r=>({...r})),content:c};return delete g.content_id,g},a=()=>{s.value=!0,ve({withData:!0}).then(t=>{i.value=t.data.data}).finally(()=>{s.value=!1})};return X(()=>{a()}),(t,c)=>{const g=T("fa-icon");return u(),h(j,null,[o("button",{onClick:a,type:"button",class:"button secondary"},[d(g,{icon:"sync",class:k({"animate-spin":s.value})},null,8,["class"]),U(" "+p(t.$t("components.buttons.refresh")),1)]),d(be,{items:n.value},{default:V(r=>[d(I(H),{class:"grid grid-cols-2 gap-4",modelValue:r.item,"onUpdate:modelValue":y=>r.item=y,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:v,"item-key":"id"},{item:V(({element:y})=>[o("div",Me,[o("label",Pe,p(I(le)(y.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])],64)}}}),Ne={key:0,class:"component-configuration-parameters"},We={class:"component-configuration-label"},Oe=E({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:i}){const n=(s,v)=>{s.content&&(s.content[v]=null)};return(s,v)=>{const a=T("fa-icon");return e.component?(u(),h("div",Ne,[(u(!0),h(j,null,re(e.component.variables,t=>(u(),h("div",{key:t.name},[o("div",We,[o("label",null,p(t.name)+":",1),d(a,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:c=>n(e.component,t.name)},null,8,["onClick"])]),e.component.content?(u(),F(fe,{key:0,modelValue:e.component.content[t.name],"onUpdate:modelValue":c=>e.component.content[t.name]=c,"default-value":t.default,name:t.name,type:t.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)}}});const He=B(Oe,[["__scopeId","data-v-f55df8de"]]),qe=e=>(ue("data-v-e8ede51d"),e=e(),de(),e),Xe=qe(()=>o("hr",null,null,-1)),je=E({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(i,n)=>{const s=T("fa-icon");return u(),h("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=Y(v=>i.$emit("click"),["stop"])),type:"button"},[Xe,o("span",null,[d(s,{icon:"square-plus"}),U(" "+p(i.$t("pages.buttons.addSection")),1)])])}}});const Q=B(je,[["__scopeId","data-v-e8ede51d"]]),{resourceFromId:Ge}=Z(),q=e=>typeof e=="string"?e:"",Je=e=>(typeof e=="number"||typeof e=="string")&&Ge(+e).url||"",xe=(e,i)=>{switch(e){case"text":return q(i);case"resource":return Je(i);case"datatable":return i;case"textarea":return q(i);default:return""}},Ke=(e,i,n)=>e.replace(`{{ $${i.name} }}`,q(n)),Qe=(e,i,n)=>[...e.matchAll(new RegExp(`<x-simplisiti::list-render.*${i.name}.*?</x-simplisiti::list-render>`,"gs"))].reduce((v,a)=>{const t=a[0],c=t?t.replace(new RegExp(/<x-simplisiti::list-render.*items.*>/,"m"),"").replace(new RegExp(/<\/x-simplisiti::list-render>/,"m"),""):"",g=[...c.matchAll(new RegExp(/\@{[{!]+\$dt->(.*.)(!!|})+}/g))],y=(n||i.value).reduce((D,R)=>D+g.reduce((A,M)=>{const N=M[1],W=M[0];return A.replaceAll(W,R[N])},c),"");return v.replace(t,y)},e),Ye=(e,i,n)=>{let s=e;return s=Ke(s,i,n),s=Qe(s,i,n),s},Ze=E({__name:"SectionPreview",props:{content:{type:String,default:""}},setup(e){const i=e,n=w(null),s=a=>{if(n.value){const t=n.value.contentDocument;if(!t)return;const[c,g]=v();t.open(),t.write(a),t.head.appendChild(c),t.body.appendChild(g),t.close(),n.value.onload=()=>{const r=t.body.firstChild,y=r==null?void 0:r.clientHeight;n.value&&(n.value.style.height=`${y}px`)}}},v=()=>{const a=document.createElement("link"),t=document.createElement("script"),c=K("style"),g=K("script");return a.rel="stylesheet",a.href=c,t.src=g,t.async=!0,[a,t]};return pe(()=>i.content,a=>{s(a)}),X(()=>{s(i.content)}),(a,t)=>(u(),h("iframe",{class:"w-screen",ref_key:"iframe",ref:n,sandbox:"allow-scripts allow-same-origin"},null,512))}}),et={class:"w-full p-4 h-screen flex flex-col overflow-y-auto"},tt={class:"form-group"},ot={class:"page-sections-container"},nt={class:"page-sections-content"},st={class:"page-sections-item-panel"},it={class:"page-sections-preview"},lt={class:"page-sections-preview-content"},at={class:"page-sections-item-buttons"},ct={class:"page-sections-components-grip-lines"},rt={class:"pages-secttions-component-buttons"},ut=["onClick"],dt=["onClick"],pt={class:"page-sections-label"},mt={class:"hideable-header"},vt={class:"page-sections-buttons"},gt={key:1},bt={key:2},ft=["onClick"],ht=E({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:0,components:[]}]}},emits:["update:sections"],setup(e,{emit:i}){const{loadResources:n}=Z(),{loadSources:s}=he(),v=e,a=w(!0),t=i,c=w(null),g=w(null),r=w("adding-component"),y=l=>{const m=[...v.sections];m.splice(l,0,J({order:0,components:[]})),t("update:sections",m)},D=()=>{t("update:sections",[...v.sections,J({order:0,components:[]})])},R=l=>{const m=[...v.sections];m.splice(l,1),t("update:sections",m)},A=(l,m)=>{l.splice(m,1)},M=(l,m)=>{a.value=!1,r.value="editing-component",c.value=l,g.value=m},N=()=>{a.value=!0,r.value="adding-component",c.value=null,g.value=null},W=l=>(l.content=l.content||ge(l),l.variables.reduce(($,C)=>{var z;const f=l.content&&l.content[C.name]?l.content[C.name]:(z=l.variables.find(O=>O.name===C.name))==null?void 0:z.default,b=f?xe(C.type,f==null?void 0:f.toString()):"";let _="";return typeof b=="string"?_=b:_=JSON.stringify(b),Ye($,C,_||"")},l.html)),te=(l,m)=>{var $,C;return(($=c.value)==null?void 0:$.id)===l.id&&l.order===((C=c.value)==null?void 0:C.order)&&g.value===m},L=w("left"),oe=()=>{L.value=L.value==="left"?"right":"left"},ne=P(()=>r.value==="adding-component"?"availableComponents":"componentConfigurationForm");return X(()=>{n(),s()}),(l,m)=>{const $=T("fa-icon"),C=me("autosize");return u(),h(j,null,[d(ee,{isInvisible:a.value,"onUpdate:isInvisible":m[1]||(m[1]=f=>a.value=f),position:L.value,showLabel:l.$t("pages.buttons.components"),canResize:!0},{default:V(()=>[o("div",et,[o("div",{class:k(`component-configuration-title ${L.value}`)},[o("h2",null,p(l.$t(`pages.titles.${ne.value}`)),1),o("div",null,[o("div",tt,[o("button",{type:"button",class:"button small default",onClick:N},p(l.$t("pages.buttons.exit")),1),o("button",{type:"button",class:"button small default button-position",onClick:oe},[d($,{icon:"border-top-left"})])])])],2),r.value==="adding-component"?(u(),F(Ae,{key:0})):S("",!0),r.value==="editing-component"?(u(),F(He,{key:1,position:L.value,"onUpdate:position":m[0]||(m[0]=f=>L.value=f),component:c.value},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),o("div",ot,[o("div",nt,[d(I(H),{list:e.sections,class:"page-sections-panel",onInput:m[2]||(m[2]=f=>l.$emit("update:sections",f)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:V(({element:f,index:b})=>[o("div",{class:k(["page-sections-list-content",{"page-sections-list-header":!b,"page-sections-list-footer":b===e.sections.length-1}])},[b?(u(),F(Q,{key:0,onClick:_=>y(b)},null,8,["onClick"])):S("",!0),o("div",st,[d(I(H),{class:"page-sections-dreaggable",modelValue:f.components,"onUpdate:modelValue":_=>f.components=_,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:V(({element:_,index:z})=>[o("div",{class:k(["page-sections-item",{"page-sections-item-selected":te(_,b)}])},[x((u(),h("div",it,[x((u(),h("div",lt,[d(Ze,{content:W(_)},null,8,["content"])])),[[C]]),o("div",at,[o("button",ct,[d($,{icon:"grip"})]),o("div",rt,[o("button",{type:"button",onClick:O=>A(f.components,z)},[d($,{icon:"trash"})],8,ut),o("button",{type:"button",onClick:O=>M(_,b)},[d($,{icon:"file-invoice"})],8,dt),o("span",pt,p(l.$t("pages.labels.component"))+" "+p((_.order=z)+1)+" - "+p(_.name),1)])])])),[[C]])],2)]),header:V(()=>[o("div",mt,[o("p",null,p(l.$t("pages.labels.addComponentsToSection",{section:b})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),o("div",vt,[b&&b!==e.sections.length-1?(u(),F($,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),b?(u(),h("span",bt,p(l.$t(b===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:f.order=b})),1)):(u(),h("span",gt,[d($,{icon:"heading"}),U(" "+p(l.$t("pages.labels.header")),1)])),o("button",{onClick:_=>R(b)},[d($,{icon:"trash"})],8,ft)])])],2)]),_:1},8,["list"]),d(Q,{onClick:D})])])],64)}}});const Tt=B(ht,[["__scopeId","data-v-1b8d66bd"]]);export{It as P,Tt as a};
