var be=Object.defineProperty;var ge=(e,o,n)=>o in e?be(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var A=(e,o,n)=>(ge(e,typeof o!="symbol"?o+"":o,n),n);import{i as ee,v as G,b as fe,g as he,c as ye}from"./helpers-73a2380c.js";import{d as P,e as _,f as R,r as U,o as d,c as f,h as t,y as w,z as _e,a as p,j as D,t as b,v as te,l as S,J as $e,_ as B,k as M,w as I,n as L,g as j,F as H,i as Ce,p as ke,m as we,K as Se,L as J,A as K}from"./index-5f5f7cb7.js";import{D as N}from"./vuedraggable.umd-cba24dbc.js";import{g as Te}from"./ComponentService-0ab3a7e0.js";import{_ as Ie}from"./Group.vue_vue_type_script_setup_true_lang-51457bc3.js";import{g as oe,p as ne,a as Ve,u as Le,b as Ue}from"./LocalStorageService-cad89000.js";import{u as se}from"./ResourceService-8695aaab.js";import{e as Pe,f as Q,h as Y,u as ze}from"./PageService-d08df8e8.js";const Ee=["onMousedown"],Me=P({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const o=e,n=_(oe("float-toolbar-width",500)),i=_(ee()),u=R(()=>`position-${o.position}-0`),m=R(()=>{switch(o.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),l=s=>{const a=s.clientX,c=n.value,h=z=>{const E=o.position==="left"?c+(z.clientX-a):c-(z.clientX-a);n.value=E<200?200:E,ne("float-toolbar-width",n.value)},$=()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",$)};window.addEventListener("mousemove",h),window.addEventListener("mouseup",$)},r=R(()=>i.value?"100%":o.canResize&&!o.isInvisible?`${n.value}px`:`${["left","right"].includes(o.position)?"initial":"100%"}`);return(s,a)=>{const c=U("fa-icon");return d(),f("div",{style:$e({width:r.value}),class:w(["float-toolbar",m.value,u.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[t("div",{class:w(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[t("div",{class:w(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[t("div",{class:w(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[_e(s.$slots,"default",{},void 0,!0)],2)],2),t("div",{class:w(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":["top","bottom"].includes(e.position),"float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right",bottom:e.position==="bottom",top:e.position==="top"}])},[t("button",{class:w(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:a[0]||(a[0]=h=>s.$emit("update:isInvisible",!e.isInvisible))},[p(c,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),D(" "+b(e.isInvisible?e.showLabel||s.$t("buttons.show"):e.hiddeLabel||s.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(d(),f("div",{key:0,class:"border-l-2 border-l-gray-400 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:te(l,["prevent","stop"])},null,40,Ee)):S("",!0)],6)}}});const ie=B(Me,[["__scopeId","data-v-511c8ca4"]]),De={class:"toolbar-container"},Fe={class:"toolbar-actions"},Re={class:"flex gap-2"},Be={type:"submit",class:"button primary"},Oe={class:"title"},Ae=["href"],Ne={class:"toolbar-route"},je={class:"toolbar-route-input"},He={class:"label"},We=["value","placeholder"],Xe={class:"toolbar-route-input"},qe={class:"label"},Ge=["value","placeholder"],Je={class:"toolbar-route-input"},Ke={class:"label"},Qe=["value","placeholder"],Ye=P({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const o=_(!0);return(n,i)=>{const u=U("fa-icon"),m=U("router-link");return d(),M(ie,{isInvisible:o.value,"onUpdate:isInvisible":i[4]||(i[4]=l=>o.value=l),showLabel:n.$t("pages.buttons.settings")},{default:I(()=>[t("div",De,[t("div",Fe,[t("div",Re,[p(m,{class:"button secondary",to:{name:"pages.index"}},{default:I(()=>[p(u,{icon:"arrow-left"}),D(" "+b(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(d(),f("button",{key:0,onClick:i[0]||(i[0]=l=>n.$emit("delete")),type:"button",class:"button danger"},b(n.$t("buttons.delete")),1)):S("",!0),t("button",Be,b(n.$t("buttons.save")),1)]),t("h1",Oe,[D(b(e.title)+" ",1),e.showDelete?(d(),f("a",{key:0,href:e.url,target:"_blank"},[p(u,{icon:"external-link-alt"})],8,Ae)):S("",!0)])]),t("div",Ne,[t("div",je,[t("label",He,b(n.$t("pages.labels.pageName")),1),t("input",{class:"input",type:"text",required:"",value:e.name,onInput:i[1]||(i[1]=l=>n.$emit("update:name",L(G)(l.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,We)]),t("div",Xe,[t("label",qe,b(n.$t("pages.labels.pageTitle")),1),t("input",{class:"input",type:"text",value:e.pageTitle,onInput:i[2]||(i[2]=l=>n.$emit("update:pageTitle",L(fe)(l.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,Ge)]),t("div",Je,[t("label",Ke,b(n.$t("pages.labels.pageUrl")),1),t("input",{class:"input",type:"text",value:e.url,onInput:i[3]||(i[3]=l=>n.$emit("update:url",L(G)(l.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,Qe)])])])]),_:1},8,["isInvisible","showLabel"])}}});const Xt=B(Ye,[["__scopeId","data-v-6a5b1085"]]),Ze={class:"overflow-y-auto mt-2"},xe={class:"tile h-24 cursor-pointer"},et={class:"tile-title cursor-grab active:cursor-grabbing"},tt=P({__name:"AvailableComponents",setup(e){const o=_([]),n=R(()=>he(o.value)),i=_(!1),u=l=>{const r={};l.variables.forEach(a=>{r[a.name]=null});const s={id:l.id||1+1,...l,variables:l.variables.map(a=>({...a})),content:r};return delete s.content_id,s},m=()=>{i.value=!0,Te({withData:!0}).then(l=>{o.value=l.data.data}).finally(()=>{i.value=!1})};return j(()=>{m()}),(l,r)=>{const s=U("fa-icon");return d(),f(H,null,[t("button",{onClick:m,type:"button",class:"button secondary"},[p(s,{icon:"sync",class:w({"animate-spin":i.value})},null,8,["class"]),D(" "+b(l.$t("components.buttons.refresh")),1)]),t("div",Ze,[p(Ie,{items:n.value},{default:I(a=>[p(L(N),{class:"grid grid-cols-2 gap-4",modelValue:a.item,"onUpdate:modelValue":c=>a.item=c,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:u,"item-key":"id"},{item:I(({element:c})=>[t("div",xe,[t("label",et,b(L(ye)(c.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])])],64)}}}),{resourceFromId:ot}=se(),Z=e=>typeof e=="string"?e==null?void 0:e.toString():"",nt=e=>(typeof e=="number"||typeof e=="string")&&ot(+e).url||"",st=e=>{if(typeof e!="number"||typeof e!="string"){const o=e;return o.rows.reduce((n,i)=>{const u=o.columns.reduce((m,l)=>{const r=i.find(c=>c.name===l.name),s=(r==null?void 0:r.value)||(r==null?void 0:r.default),a=!(r!=null&&r.type)||!s?null:ae(r==null?void 0:r.type,s);return m[l.name]=a,m},{});return[...n,u]},[])}return[]},ae=(e,o)=>{switch(e){case"text":return Z(o);case"resource":return nt(o);case"datatable":return st(o);case"textarea":return Z(o);default:return""}},le=(e,o)=>e.variables.reduce((i,u)=>{var r;const m=o&&o[u.name]?o[u.name]:(r=e.variables.find(s=>s.name===u.name))==null?void 0:r.default,l=m?ae(u.type,m):"";return i[u.name]=l,i},{});class it{constructor(){A(this,"component");A(this,"subscribedComponents",{})}subscribe(o,n){o.id&&(this.subscribedComponents[o.id]=n)}attach(o){this.component=o}detach(){this.component=void 0}update(){var o,n,i;this.component&&this.component.id&&((i=(n=this.subscribedComponents)[this.component.id])==null||i.call(n,le(this.component,(o=this.component)==null?void 0:o.content)||{}))}}const at=new it,W=()=>at,lt={key:0,class:"component-configuration-parameters"},ct={class:"component-configuration-label"},rt=P({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:o}){const n=W(),i=(m,l)=>{m.content&&(m.content[l]=null)},u=()=>{n.update()};return(m,l)=>{const r=U("fa-icon");return e.component?(d(),f("div",lt,[(d(!0),f(H,null,Ce(e.component.variables,s=>(d(),f("div",{key:s.name},[t("div",ct,[t("label",null,b(s.name)+":",1),p(r,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:a=>i(e.component,s.name)},null,8,["onClick"])]),e.component.content?(d(),M(Ve,{key:0,editStructure:!1,modelValue:e.component.content[s.name],"onUpdate:modelValue":[a=>e.component.content[s.name]=a,u],"default-value":s.default,name:s.name,type:s.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)}}});const ut=B(rt,[["__scopeId","data-v-8aa60c2a"]]),dt=e=>(ke("data-v-e8ede51d"),e=e(),we(),e),pt=dt(()=>t("hr",null,null,-1)),mt=P({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(o,n)=>{const i=U("fa-icon");return d(),f("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=te(u=>o.$emit("click"),["stop"])),type:"button"},[pt,t("span",null,[p(i,{icon:"square-plus"}),D(" "+b(o.$t("pages.buttons.addSection")),1)])])}}});const x=B(mt,[["__scopeId","data-v-e8ede51d"]]),vt={class:"relative"},bt=t("div",{class:"absolute inset-0"},null,-1),gt=P({__name:"ComponentPreview",props:{component:{type:Object,required:!0}},setup(e){const o=W(),n=e,i=_(null),u=async s=>{if(!n.component.id)return;const a=await Pe(n.component.id,s);if(i.value){const c=i.value.contentDocument;if(!c)return;const[h,$]=l(),[z,E]=r();c.open(),c.write(a.data),c.head.appendChild(h),c.head.appendChild(z),c.body.appendChild($),c.body.appendChild(E),c.close(),i.value.onload=()=>{const O=c.body.scrollHeight;i.value&&(i.value.style.height=`${O}px`)}}},m=()=>{if(i.value){const s=i.value.contentDocument;if(!s)return;const a=s.body.offsetHeight;i.value.style.height=`${a}px`}},l=()=>{const s=document.createElement("link"),a=document.createElement("script"),c=Q("style"),h=Q("script");return s.rel="stylesheet",s.href=c,a.src=h,a.async=!0,[s,a]},r=()=>{const s=document.createElement("link"),a=document.createElement("script"),c=Y("style"),h=Y("script");return s.rel="stylesheet",s.href=c,a.src=h,a.async=!0,[s,a]};return j(()=>{u(le(n.component,n.component.content)),o.subscribe(n.component,s=>{u(s).then(()=>m())})}),(s,a)=>(d(),f("div",vt,[t("iframe",{class:"w-screen",ref_key:"iframe",ref:i,sandbox:"allow-scripts allow-same-origin"},null,512),bt]))}}),ft={class:"w-full p-4 flex flex-col overflow-y-auto h-[60vh] md:h-full"},ht={class:"form-group"},yt={class:"page-sections-container"},_t={class:"page-sections-content"},$t={class:"page-sections-item-panel"},Ct={class:"page-sections-preview"},kt={class:"page-sections-preview-content"},wt={class:"page-sections-item-buttons"},St={class:"page-sections-components-grip-lines"},Tt={class:"pages-secttions-component-buttons"},It=["onClick"],Vt=["onClick"],Lt={class:"page-sections-label"},Ut={class:"hideable-header"},Pt={class:"page-sections-buttons"},zt={key:1},Et={key:2},Mt=["onClick"],Dt=P({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:1,components:[]}]},pageEditionMode:{type:String,default:"adding-component"}},emits:["update:sections"],setup(e,{emit:o}){const{loadResources:n}=se(),{loadSources:i}=Le(),{loadActions:u}=Ue(),{loadPages:m}=ze(),l=W(),r=e,s=_(!0),a=o,c=_(null),h=_(null),$=_("adding-component"),z=v=>{const g=[...r.sections];g.splice(v,0,J({order:0,components:[]})),a("update:sections",g)},E=()=>{a("update:sections",[...r.sections,J({order:0,components:[]})])},O=v=>{const g=[...r.sections];g.splice(v,1),a("update:sections",g)},ce=(v,g)=>{v.splice(g,1)},re=(v,g)=>{s.value=!1,$.value="editing-component",c.value=v,h.value=g,l.attach(v)},ue=()=>{s.value=!0,$.value="adding-component",l.detach(),c.value=null,h.value=null},de=(v,g)=>{var C,F;return((C=c.value)==null?void 0:C.id)===v.id&&v.order===((F=c.value)==null?void 0:F.order)&&h.value===g},X=_(ee()),V=_(oe("float-toolbar-position",X.value?"bottom":"left")),pe=()=>{V.value=V.value==="left"?"right":"left",ne("float-toolbar-position",V.value)},me=R(()=>$.value==="adding-component"?"availableComponents":"componentConfigurationForm");return j(()=>{n(),i(),u(),m()}),(v,g)=>{const C=U("fa-icon"),F=Se("autosize");return d(),f(H,null,[p(ie,{isInvisible:s.value,"onUpdate:isInvisible":g[1]||(g[1]=k=>s.value=k),position:V.value,showLabel:v.$t($.value==="editing-component"?"pages.buttons.settings":"pages.buttons.components"),canResize:!0},{default:I(()=>[t("div",ft,[t("div",{class:w(`component-configuration-title ${V.value}`)},[t("h2",null,b(v.$t(`pages.titles.${me.value}`)),1),t("div",null,[t("div",ht,[t("button",{type:"button",class:"button small default",onClick:ue},b(v.$t("pages.buttons.exit")),1),X.value?S("",!0):(d(),f("button",{key:0,type:"button",class:"button small default button-position",onClick:pe},[p(C,{icon:"border-top-left"})]))])])],2),$.value==="adding-component"?(d(),M(tt,{key:0})):S("",!0),$.value==="editing-component"?(d(),M(ut,{key:1,position:V.value,"onUpdate:position":g[0]||(g[0]=k=>V.value=k),component:c.value},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),t("div",yt,[t("div",_t,[p(L(N),{list:e.sections,class:"page-sections-panel",onInput:g[2]||(g[2]=k=>v.$emit("update:sections",k)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:I(({element:k,index:y})=>[t("div",{class:w(["page-sections-list-content",{"page-sections-list-header":!y,"page-sections-list-footer":y===e.sections.length-1}])},[y?(d(),M(x,{key:0,onClick:T=>z(y)},null,8,["onClick"])):S("",!0),t("div",$t,[p(L(N),{class:"page-sections-dreaggable",modelValue:k.components,"onUpdate:modelValue":T=>k.components=T,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:I(({element:T,index:q})=>[t("div",{class:w(["page-sections-item",{"page-sections-item-selected":de(T,y)}])},[K((d(),f("div",Ct,[K((d(),f("div",kt,[p(gt,{component:T},null,8,["component"])])),[[F]]),t("div",wt,[t("button",St,[p(C,{icon:"grip"})]),t("div",Tt,[t("button",{type:"button",onClick:ve=>ce(k.components,q)},[p(C,{icon:"trash"})],8,It),t("button",{type:"button",onClick:ve=>re(T,y)},[p(C,{icon:"file-invoice"})],8,Vt),t("span",Lt,b(v.$t("pages.labels.component"))+" "+b((T.order=q)+1)+" - "+b(T.name),1)])])])),[[F]])],2)]),header:I(()=>[t("div",Ut,[p(C,{icon:"triangle-exclamation"}),t("p",null,b(v.$t("pages.labels.addComponentsToSection",{section:y})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t("div",Pt,[y&&y!==e.sections.length-1?(d(),M(C,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),y?(d(),f("span",Et,b(v.$t(y===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:k.order=y})),1)):(d(),f("span",zt,[p(C,{icon:"heading"}),D(" "+b(v.$t("pages.labels.header")),1)])),t("button",{onClick:T=>O(y)},[p(C,{icon:"trash"})],8,Mt)])])],2)]),_:1},8,["list"]),p(x,{onClick:E})])])],64)}}});const qt=B(Dt,[["__scopeId","data-v-298247df"]]);export{Xt as P,qt as a};
