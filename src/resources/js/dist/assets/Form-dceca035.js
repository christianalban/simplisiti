import{v as X,i as ae,g as ie,c as le}from"./helpers-66e66eca.js";import{d as E,e as C,f as P,r as I,o as m,c as b,h as o,y as w,I as ce,a as p,j as F,t as g,v as Q,l as S,J as re,_ as z,k as D,w as T,n as V,g as x,F as H,i as ue,p as de,m as pe,D as me,K as ge,L as q,z as G}from"./index-10cf6b0e.js";import{D as W}from"./vuedraggable.umd-e314fe8b.js";import{g as ve,b as fe}from"./ComponentService-5bcbfd07.js";import{_ as be}from"./Group.vue_vue_type_script_setup_true_lang-7f668604.js";import{a as he,u as _e}from"./ControlTypeSelector.vue_vue_type_script_setup_true_lang-a3d31050.js";import{u as Y}from"./ResourceService-371d19a0.js";import{b as J}from"./PageService-425b2f75.js";const ye=["onMousedown"],$e=E({__name:"FloatToolbar",props:{position:{type:String,default:"top"},isInvisible:{type:Boolean,default:!1},showLabel:{type:String},hiddeLabel:{type:String},canResize:{type:Boolean,default:!1}},emits:["update:isInvisible"],setup(e){const i=e,n=C(500),s=P(()=>`position-${i.position}-0`),u=P(()=>{switch(i.position){case"left":return"position-left";case"right":return"position-right";case"top":return"position-top";case"bottom":return"position-bottom"}}),c=t=>{const a=t.clientX,d=n.value,r=U=>{const R=d+(U.clientX-a);n.value=R<200?200:R},h=()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",h)};window.addEventListener("mousemove",r),window.addEventListener("mouseup",h)};return(t,a)=>{const d=I("fa-icon");return m(),b("div",{style:re({width:e.canResize&&!e.isInvisible?`${n.value}px`:`${["left","right"].includes(e.position)?"initial":"100%"}`}),class:w(["float-toolbar",u.value,s.value,{"float-toolbar-top":e.position==="top","float-toolbar-right":["left","right"].includes(e.position)}])},[o("div",{class:w(["float-toolbar-container",{"float-toolbar-container-vertical":["top","bottom"].includes(e.position)}])},[o("div",{class:w(["float-toolbar-accordion",{"float-toolbar-accordion-contracted":e.isInvisible,"float-toolbar-accordion-contracted-vertical":e.isInvisible&&["top","bottom"].includes(e.position),"float-toolbar-accordion-contracted-horizontal ":e.isInvisible&&["left","right"].includes(e.position)}])},[o("div",{class:w(["float-toolbar-content",{"rounded-top":e.position==="top","rounded-bottom":e.position==="bottom","rounded-left":e.position==="left","rounded-right":e.position==="right"}])},[ce(t.$slots,"default",{},void 0,!0)],2)],2),o("div",{class:w(["float-toolbar-buttons",{"float-toolbar-buttons-vertical":e.position==="top","float-toolbar-buttons-horizontal":["left","right"].includes(e.position),left:e.position==="left",right:e.position==="right"}])},[o("button",{class:w(["float-toolbar-button",{"vertical-mode":["left","right"].includes(e.position)}]),type:"button",onClick:a[0]||(a[0]=r=>t.$emit("update:isInvisible",!e.isInvisible))},[p(d,{icon:e.isInvisible?"eye":"eye-slash"},null,8,["icon"]),F(" "+g(e.isInvisible?e.showLabel||t.$t("buttons.show"):e.hiddeLabel||t.$t("buttons.hide")),1)],2)],2)],2),e.canResize?(m(),b("div",{key:0,class:"border-l-2 border-l-gray-200 hover:border-l-blue-500 transition-colors h-full hover:cursor-col-resize",onMousedown:Q(c,["prevent","stop"])},null,40,ye)):S("",!0)],6)}}});const Z=z($e,[["__scopeId","data-v-a7437315"]]),ke={class:"toolbar-container"},we={class:"toolbar-actions"},Ce={type:"submit",class:"button-link"},Se={class:"title"},Te=["href"],Ve={class:"toolbar-route"},Ie={class:"toolbar-route-input"},Ee={class:"label"},Re=["value","placeholder"],Le={class:"toolbar-route-input"},De={class:"label"},Fe=["value","placeholder"],Ue={class:"toolbar-route-input"},ze={class:"label"},Be=["value","placeholder"],Me=E({__name:"PageToolbar",props:{showDelete:Boolean,title:String,name:{type:String,default:""},url:{type:String,default:""},pageTitle:{type:String,default:""},pageEditionMode:{type:String,default:"adding-component"}},emits:["delete","update:name","update:pageTitle","update:url"],setup(e){const i=C(!0);return(n,s)=>{const u=I("fa-icon"),c=I("router-link");return m(),D(Z,{isInvisible:i.value,"onUpdate:isInvisible":s[4]||(s[4]=t=>i.value=t),showLabel:n.$t("pages.buttons.settings")},{default:T(()=>[o("div",ke,[o("div",we,[p(c,{class:"button-link",to:{name:"pages.index"}},{default:T(()=>[p(u,{icon:"arrow-left"}),F(" "+g(n.$t("buttons.back")),1)]),_:1},8,["to"]),e.showDelete?(m(),b("button",{key:0,onClick:s[0]||(s[0]=t=>n.$emit("delete")),type:"button",class:"button-link danger"},g(n.$t("buttons.delete")),1)):S("",!0),o("button",Ce,g(n.$t("buttons.save")),1),o("h1",Se,[F(g(e.title)+" ",1),e.showDelete?(m(),b("a",{key:0,href:e.url,target:"_blank"},[p(u,{icon:"external-link-alt"})],8,Te)):S("",!0)])]),o("div",Ve,[o("div",Ie,[o("label",Ee,g(n.$t("pages.labels.pageName")),1),o("input",{class:"input",type:"text",required:"",value:e.name,onInput:s[1]||(s[1]=t=>n.$emit("update:name",V(X)(t.target))),placeholder:n.$t("pages.placeholders.pageName")},null,40,Re)]),o("div",Le,[o("label",De,g(n.$t("pages.labels.pageTitle")),1),o("input",{class:"input",type:"text",value:e.pageTitle,onInput:s[2]||(s[2]=t=>n.$emit("update:pageTitle",V(ae)(t.target))),placeholder:n.$t("pages.placeholders.pageTitle")},null,40,Fe)]),o("div",Ue,[o("label",ze,g(n.$t("pages.labels.pageUrl")),1),o("input",{class:"input",type:"text",value:e.url,onInput:s[3]||(s[3]=t=>n.$emit("update:url",V(X)(t.target))),placeholder:n.$t("pages.placeholders.pageUrl")},null,40,Be)])])])]),_:1},8,["isInvisible","showLabel"])}}});const It=z(Me,[["__scopeId","data-v-e5b92884"]]),Pe={class:"tile h-24 cursor-pointer"},Ae={class:"tile-title cursor-grab active:cursor-grabbing"},Ne=E({__name:"AvailableComponents",setup(e){const i=C([]),n=P(()=>ie(i.value)),s=C(!1),u=t=>{const a={};t.variables.forEach(r=>{a[r.name]=null});const d={id:t.id||1+1,...t,variables:t.variables.map(r=>({...r})),content:a};return delete d.content_id,d},c=()=>{s.value=!0,ve({withData:!0}).then(t=>{i.value=t.data.data}).finally(()=>{s.value=!1})};return x(()=>{c()}),(t,a)=>{const d=I("fa-icon");return m(),b(H,null,[o("button",{onClick:c,type:"button",class:"button secondary"},[p(d,{icon:"sync",class:w({"animate-spin":s.value})},null,8,["class"]),F(" "+g(t.$t("components.buttons.refresh")),1)]),p(be,{items:n.value},{default:T(r=>[p(V(W),{class:"grid grid-cols-2 gap-4",modelValue:r.item,"onUpdate:modelValue":h=>r.item=h,group:{name:"components",pull:"clone",put:!1},sort:!1,clone:u,"item-key":"id"},{item:T(({element:h})=>[o("div",Pe,[o("label",Ae,g(V(le)(h.name)),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])],64)}}}),Oe={key:0,class:"component-configuration-parameters"},We={class:"component-configuration-label"},je=E({__name:"ComponentConfigurationForm",props:{component:{type:Object},position:{type:String,default:"left"}},emits:["update:position"],setup(e,{emit:i}){const n=(s,u)=>{s.content&&(s.content[u]=null)};return(s,u)=>{const c=I("fa-icon");return e.component?(m(),b("div",Oe,[(m(!0),b(H,null,ue(e.component.variables,t=>(m(),b("div",{key:t.name},[o("div",We,[o("label",null,g(t.name)+":",1),p(c,{class:"component-configuration-set-default",icon:"arrows-rotate",onClick:a=>n(e.component,t.name)},null,8,["onClick"])]),e.component.content?(m(),D(he,{key:0,modelValue:e.component.content[t.name],"onUpdate:modelValue":a=>e.component.content[t.name]=a,"default-value":t.default,name:t.name,type:t.type},null,8,["modelValue","onUpdate:modelValue","default-value","name","type"])):S("",!0)]))),128))])):S("",!0)}}});const xe=z(je,[["__scopeId","data-v-f55df8de"]]),He=e=>(de("data-v-e8ede51d"),e=e(),pe(),e),Xe=He(()=>o("hr",null,null,-1)),qe=E({__name:"PageSectionButtonAdd",emits:["click"],setup(e){return(i,n)=>{const s=I("fa-icon");return m(),b("button",{class:"page-sections-buttons-add",onClick:n[0]||(n[0]=Q(u=>i.$emit("click"),["stop"])),type:"button"},[Xe,o("span",null,[p(s,{icon:"square-plus"}),F(" "+g(i.$t("pages.buttons.addSection")),1)])])}}});const K=z(qe,[["__scopeId","data-v-e8ede51d"]]),{resourceFromId:Ge}=Y(),j=e=>typeof e=="string"?e==null?void 0:e.toString():"",Je=e=>(typeof e=="number"||typeof e=="string")&&Ge(+e).url||"",Ke=e=>{if(typeof e!="number"||typeof e!="string"){const i=e;return i.rows.reduce((n,s)=>{const u=i.columns.reduce((c,t)=>{const a=s.find(h=>h.name===t.name),d=(a==null?void 0:a.value)||(a==null?void 0:a.default);if(!a||!d)return c;const r=ee(a==null?void 0:a.type,d);return c[t.name]=r,c},{});return[...n,u]},[])}return[]},ee=(e,i)=>{switch(e){case"text":return j(i);case"resource":return Je(i);case"datatable":return Ke(i);case"textarea":return j(i);default:return""}},Qe=(e,i,n)=>e.replaceAll(new RegExp(`{{\\s*\\$${i.name}\\s*}}`,"g"),j(n)),Ye=(e,i,n)=>[...e.matchAll(new RegExp(`<x-simplisiti::list-render.*${i.name}.*?</x-simplisiti::list-render>`,"gs"))].reduce((u,c)=>{const t=c[0],a=t?t.replace(new RegExp(/<x-simplisiti::list-render.*items.*>/,"m"),"").replace(new RegExp(/<\/x-simplisiti::list-render>/,"m"),""):"",d=[...a.matchAll(new RegExp(/\@{[{!]+\s*\$dt->(.*.)(!!|})+}/g))],r=n||i.value;if(!r)return u;const h=r.reduce((U,R)=>U+d.reduce((A,B)=>{const N=B[1],O=B[0];return A.replaceAll(O,R[N])},a),"");return u.replace(t,h)},e),Ze=(e,i,n)=>{let s=e;return s=Ye(s,i,n),s=Qe(s,i,n),s},et=E({__name:"SectionPreview",props:{content:{type:String,default:""}},setup(e){const i=e,n=C(null),s=c=>{if(n.value){const t=n.value.contentDocument;if(!t)return;const[a,d]=u();t.open(),t.write(c),t.head.appendChild(a),t.body.appendChild(d),t.close(),n.value.onload=()=>{const r=t.body.firstChild,h=r==null?void 0:r.clientHeight;n.value&&(n.value.style.height=`${h}px`)}}},u=()=>{const c=document.createElement("link"),t=document.createElement("script"),a=J("style"),d=J("script");return c.rel="stylesheet",c.href=a,t.src=d,t.async=!0,[c,t]};return me(()=>i.content,c=>{s(c)}),x(()=>{s(i.content)}),(c,t)=>(m(),b("iframe",{class:"w-screen",ref_key:"iframe",ref:n,sandbox:"allow-scripts allow-same-origin"},null,512))}}),tt={class:"w-full p-4 h-screen flex flex-col overflow-y-auto"},ot={class:"form-group"},nt={class:"page-sections-container"},st={class:"page-sections-content"},at={class:"page-sections-item-panel"},it={class:"page-sections-preview"},lt={class:"page-sections-preview-content"},ct={class:"page-sections-item-buttons"},rt={class:"page-sections-components-grip-lines"},ut={class:"pages-secttions-component-buttons"},dt=["onClick"],pt=["onClick"],mt={class:"page-sections-label"},gt={class:"hideable-header"},vt={class:"page-sections-buttons"},ft={key:1},bt={key:2},ht=["onClick"],_t=E({__name:"Form",props:{sections:{type:Array,default:()=>[{order:0,components:[]},{order:0,components:[]}]},pageEditionMode:{type:String,default:"adding-component"}},emits:["update:sections"],setup(e,{emit:i}){const{loadResources:n}=Y(),{loadSources:s}=_e(),u=e,c=C(!0),t=i,a=C(null),d=C(null),r=C("adding-component"),h=l=>{const v=[...u.sections];v.splice(l,0,q({order:0,components:[]})),t("update:sections",v)},U=()=>{t("update:sections",[...u.sections,q({order:0,components:[]})])},R=l=>{const v=[...u.sections];v.splice(l,1),t("update:sections",v)},A=(l,v)=>{l.splice(v,1)},B=(l,v)=>{c.value=!1,r.value="editing-component",a.value=l,d.value=v},N=()=>{c.value=!0,r.value="adding-component",a.value=null,d.value=null},O=l=>(l.content=l.content||fe(l),l.variables.reduce((_,k)=>{var $;const y=l.content&&l.content[k.name]?l.content[k.name]:($=l.variables.find(M=>M.name===k.name))==null?void 0:$.default,f=y?ee(k.type,y):"";return Ze(_,k,f)},l.html)),te=(l,v)=>{var _,k;return((_=a.value)==null?void 0:_.id)===l.id&&l.order===((k=a.value)==null?void 0:k.order)&&d.value===v},L=C("left"),oe=()=>{L.value=L.value==="left"?"right":"left"},ne=P(()=>r.value==="adding-component"?"availableComponents":"componentConfigurationForm");return x(()=>{n(),s()}),(l,v)=>{const _=I("fa-icon"),k=ge("autosize");return m(),b(H,null,[p(Z,{isInvisible:c.value,"onUpdate:isInvisible":v[1]||(v[1]=y=>c.value=y),position:L.value,showLabel:l.$t("pages.buttons.components"),canResize:!0},{default:T(()=>[o("div",tt,[o("div",{class:w(`component-configuration-title ${L.value}`)},[o("h2",null,g(l.$t(`pages.titles.${ne.value}`)),1),o("div",null,[o("div",ot,[o("button",{type:"button",class:"button small default",onClick:N},g(l.$t("pages.buttons.exit")),1),o("button",{type:"button",class:"button small default button-position",onClick:oe},[p(_,{icon:"border-top-left"})])])])],2),r.value==="adding-component"?(m(),D(Ne,{key:0})):S("",!0),r.value==="editing-component"?(m(),D(xe,{key:1,position:L.value,"onUpdate:position":v[0]||(v[0]=y=>L.value=y),component:a.value},null,8,["position","component"])):S("",!0)])]),_:1},8,["isInvisible","position","showLabel"]),o("div",nt,[o("div",st,[p(V(W),{list:e.sections,class:"page-sections-panel",onInput:v[2]||(v[2]=y=>l.$emit("update:sections",y)),group:"sections","item-key":"id",handle:".page-sections-grip-lines"},{item:T(({element:y,index:f})=>[o("div",{class:w(["page-sections-list-content",{"page-sections-list-header":!f,"page-sections-list-footer":f===e.sections.length-1}])},[f?(m(),D(K,{key:0,onClick:$=>h(f)},null,8,["onClick"])):S("",!0),o("div",at,[p(V(W),{class:"page-sections-dreaggable",modelValue:y.components,"onUpdate:modelValue":$=>y.components=$,group:"components","item-key":"id",handle:".page-sections-components-grip-lines"},{item:T(({element:$,index:M})=>[o("div",{class:w(["page-sections-item",{"page-sections-item-selected":te($,f)}])},[G((m(),b("div",it,[G((m(),b("div",lt,[p(et,{content:O($)},null,8,["content"])])),[[k]]),o("div",ct,[o("button",rt,[p(_,{icon:"grip"})]),o("div",ut,[o("button",{type:"button",onClick:se=>A(y.components,M)},[p(_,{icon:"trash"})],8,dt),o("button",{type:"button",onClick:se=>B($,f)},[p(_,{icon:"file-invoice"})],8,pt),o("span",mt,g(l.$t("pages.labels.component"))+" "+g(($.order=M)+1)+" - "+g($.name),1)])])])),[[k]])],2)]),header:T(()=>[o("div",gt,[p(_,{icon:"triangle-exclamation"}),o("p",null,g(l.$t("pages.labels.addComponentsToSection",{section:f})),1)])]),_:2},1032,["modelValue","onUpdate:modelValue"]),o("div",vt,[f&&f!==e.sections.length-1?(m(),D(_,{key:0,icon:"grip",class:"page-sections-grip-lines"})):S("",!0),f?(m(),b("span",bt,g(l.$t(f===e.sections.length-1?"pages.labels.footer":"pages.labels.section",{section:y.order=f})),1)):(m(),b("span",ft,[p(_,{icon:"heading"}),F(" "+g(l.$t("pages.labels.header")),1)])),o("button",{onClick:$=>R(f)},[p(_,{icon:"trash"})],8,ht)])])],2)]),_:1},8,["list"]),p(K,{onClick:U})])])],64)}}});const Et=z(_t,[["__scopeId","data-v-0d6f86d1"]]);export{It as P,Et as a};
