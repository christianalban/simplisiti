import{_ as A}from"./CodeEditor.vue_vue_type_script_setup_true_lang-86cfc0bf.js";import{u as D}from"./ResourceService-d2173ada.js";import{_ as M,a as I,g as O,u as z,b as E,p as H}from"./LocalStorageService-3ea4f23d.js";import{u as P}from"./PageService-ee1ecdca.js";import{a as W,v as Q}from"./helpers-d1a74e74.js";import{b as T,d as U,x as G,e as h,f as J,r as q,o as f,c as w,h as o,a as r,A as k,k as C,l as V,g as K,t as S,w as R,n as L,j as X,F as Y,_ as Z}from"./index-82dfae72.js";import{_ as ee}from"./Modal.vue_vue_type_script_setup_true_lang-a06205dc.js";import{_ as te}from"./Form.vue_vue_type_script_setup_true_lang-98dc6f90.js";import{D as ae}from"./vuedraggable.umd-5941533b.js";const B=e=>e?["datasource","resource",null].includes(e):!1,se=async(e,d)=>{const s=W(`component/${e}/variable/${d.name}/${d.type}/settings`,{withSettings:!0},{default:d.default});return await T.get(s)},oe={class:"form-group h-14"},ne={class:"variable-grip-lines button primary flex cursor-move !px-1 items-center justify-center"},le=["value","placeholder"],ie={class:"flex flex-col text-xs w-14"},ue=["disabled"],re=["disabled"],de=U({__name:"VariableConfigItem",props:{type:{type:String,required:!0},name:{type:String,required:!0},default:{type:[String,Number,Object,null,void 0],required:!0},settings:{type:Array,default:[]},showRemove:{type:Boolean,default:!0}},emits:["update:type","update:name","update:default","removeVariable","displaySettings"],setup(e,{emit:d}){const s=e,$=G(),p=h(s.name),b=d,v=J(()=>B(s.type)),i=()=>{b("removeVariable")},y=()=>{s.type==="resource"&&b("displaySettings",s.settings),s.type==="datasource"&&se($.params.component,{type:s.type,name:s.name,default:s.default}).then(n=>{b("displaySettings",n.data.data)})},g=n=>p.value=Q(n.target);return(n,u)=>{const x=q("fa-icon");return f(),w("div",oe,[o("div",ne,[r(x,{icon:"grip-lines",class:"text-gray-500"})]),r(M,{class:"w-20",modelValue:e.type,"onUpdate:modelValue":u[0]||(u[0]=m=>n.$emit("update:type",m))},null,8,["modelValue"]),o("input",{type:"text",class:"input w-32",value:p.value,onInput:u[1]||(u[1]=m=>g(m)),onBlur:u[2]||(u[2]=m=>n.$emit("update:name",p.value)),placeholder:n.$t("components.placeholders.name")},null,40,le),r(I,{class:"flex-1",modelValue:e.default,"onUpdate:modelValue":u[3]||(u[3]=m=>n.$emit("update:default",m)),name:e.name,type:e.type},null,8,["modelValue","name","type"]),o("div",ie,[o("button",{type:"button",class:k(["variable-button flex-1 rounded-tr",{"bg-blue-200 text-blue-900":v.value,"bg-blue-100 text-blue-300 cursor-not-allowed":!v.value}]),onClick:y,disabled:!v.value},[r(x,{icon:"gear"})],10,ue),o("button",{type:"button",class:k(["variable-button flex-1 bg-red-200 text-red-900 rounded-br ",{"hover:bg-red-300 cursor-pointer":e.showRemove,"cursor-not-allowed":!e.showRemove}]),onClick:i,disabled:!e.showRemove},[r(x,{icon:"minus"})],10,re)])])}}}),pe=U({__name:"VariableSettings",props:{variable:{type:[Object,null],required:!0},settings:{type:Object,required:!0}},emits:["update:settings"],setup(e,{emit:d}){return(s,$)=>{var p;return((p=e.variable)==null?void 0:p.type)==="datasource"?(f(),C(te,{key:0,settingMenu:e.settings},null,8,["settingMenu"])):V("",!0)}}}),me={class:"flex flex-col gap-4 flex-1 overflow-hidden"},ce={class:"flex flex-col-reverse md:flex-row gap-4 w-full overflow-hidden flex-1 h-full pb-2"},fe={class:"flex-1 flex flex-col overflow-hidden"},ve={class:"title mb-4"},ge={class:"flex gap-2"},be={key:0,class:"title"},ye={key:0,class:"overflow-y-auto flex flex-col flex-1 bg-gray-100 rounded-lg"},xe={key:1,class:"w-full mt-auto"},_e=U({__name:"Form",props:{code:{type:String,default:"<div>Hello World</div>"},variables:{type:Array,default:()=>[{type:"text",name:"",default:""}]}},emits:["update:code","update:variables","update:name"],setup(e,{emit:d}){const{loadResources:s}=D(),{loadSources:$}=z(),{loadActions:p}=E(),{loadPages:b}=P(),v=e,i=h(O("variables-expanded",window.innerWidth>768)),y=h(!1),g=h([]),n=h(null),u=d,x=()=>{u("update:variables",[...v.variables,{type:"text",name:"",default:""}])},m=a=>{u("update:variables",v.variables.filter((l,_)=>_!==a))},F=(a,l)=>{B(a.type)&&(n.value=a,a.type==="resource"?g.value=a.applied_settings||[]:g.value=l||a.settings||[],a.settings=l,y.value=!0)},N=()=>{i.value=!i.value,H("variables-expanded",i.value)};return K(()=>{s(),$(),p(),b()}),(a,l)=>{const _=q("fa-icon");return f(),w(Y,null,[o("div",me,[o("div",ce,[o("div",fe,[o("h2",ve,S(a.$t("components.titles.code")),1),r(A,{code:v.code,"onUpdate:code":l[0]||(l[0]=t=>a.$emit("update:code",t)),language:"html"},null,8,["code"])]),o("div",{class:k(["flex flex-col gap-2",{"md:w-4/12":i.value,"w-auto":!i.value}])},[o("div",ge,[o("button",{class:"button primary w-8 !p-0 aspect-square text-xs",type:"button",onClick:N},[i.value?(f(),C(_,{key:0,icon:"minimize"})):(f(),C(_,{key:1,icon:"maximize"}))]),i.value?(f(),w("h2",be,S(a.$t("components.titles.variables")),1)):V("",!0)]),i.value?(f(),w("div",ye,[r(L(ae),{class:"flex flex-col flex-1 gap-2 p-2",list:e.variables,group:"variables","item-key":"name",handle:".variable-grip-lines"},{item:R(({element:t,index:j})=>[r(de,{type:t.type,"onUpdate:type":c=>t.type=c,name:t.name,"onUpdate:name":c=>t.name=c,default:t.default,"onUpdate:default":c=>t.default=c,settings:t.settings,showRemove:e.variables.length>1,onRemoveVariable:c=>m(j),onDisplaySettings:c=>F(t,c)},null,8,["type","onUpdate:type","name","onUpdate:name","default","onUpdate:default","settings","showRemove","onRemoveVariable","onDisplaySettings"])]),_:1},8,["list"])])):V("",!0),i.value?(f(),w("div",xe,[o("button",{type:"button",class:"variable-button bg-teal-200 hover:bg-teal-300 text-teal-900 w-full rounded",onClick:x},[r(_,{icon:"plus"}),X(" "+S(a.$t("components.buttons.addVariable")),1)])])):V("",!0)],2)])]),r(ee,{title:a.$t("titles.settings"),showModal:y.value,"onUpdate:showModal":l[2]||(l[2]=t=>y.value=t),onClose:l[3]||(l[3]=t=>n.value=null)},{default:R(()=>[r(pe,{variable:n.value,settings:g.value,"onUpdate:settings":l[1]||(l[1]=t=>g.value=t)},null,8,["variable","settings"])]),_:1},8,["title","showModal"])],64)}}});const qe=Z(_e,[["__scopeId","data-v-a59927b5"]]);export{qe as C};
