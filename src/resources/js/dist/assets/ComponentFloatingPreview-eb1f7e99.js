var $=Object.defineProperty;var R=(t,e,n)=>e in t?$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var f=(t,e,n)=>(R(t,typeof e!="symbol"?e+"":e,n),n);import{e as w,f as b,h as _}from"./PageService-9a20781d.js";import{u as S}from"./ResourceService-86b075d1.js";import{d as C,e as h,g as U,o as p,c as m,h as v,r as V,B,A as E,a as z,t as D,k as F,_ as H}from"./index-c9121d9d.js";const{resourceFromId:I}=S(),g=t=>typeof t=="string"?t==null?void 0:t.toString():"",L=t=>{var e;return(typeof t=="number"||typeof t=="string")&&((e=I(+t))==null?void 0:e.url)||""},j=t=>{if(typeof t!="number"||typeof t!="string"){const e=t;return e.rows.reduce((n,o)=>{const i=e.columns.reduce((l,u)=>{const r=o.find(c=>c.name===u.name),s=(r==null?void 0:r.value)||(r==null?void 0:r.default),a=!(r!=null&&r.type)||!s?null:x(r==null?void 0:r.type,s);return l[u.name]=a,l},{});return[...n,i]},[])}return[]},x=(t,e)=>{switch(t){case"text":return g(e);case"resource":return L(e);case"datatable":return j(e);case"textarea":return g(e);default:return""}},y=(t,e)=>t.variables.reduce((o,i)=>{var r;const l=e&&e[i.name]?e[i.name]:(r=t.variables.find(s=>s.name===i.name))==null?void 0:r.default,u=l?x(i.type,l):"";return o[i.name]=u,o},{});class q{constructor(){f(this,"component");f(this,"subscribedComponents",{})}subscribe(e,n){e.id&&(this.subscribedComponents[e.id]=n)}attach(e){this.component=e}detach(){this.component=void 0}update(){var e,n,o;this.component&&this.component.id&&((o=(n=this.subscribedComponents)[this.component.id])==null||o.call(n,y(this.component,(e=this.component)==null?void 0:e.content)||{}))}}const M=new q,N=()=>M,A={class:"relative"},G=v("div",{class:"absolute inset-0"},null,-1),J=C({__name:"ComponentPreview",props:{component:{type:Object,required:!0},html:{type:[String,null],default:null}},setup(t){const e=N(),n=t,o=h(null),i=async s=>{if(!n.component.id)return;const a=n.html??(await w(n.component.id,s)).data;if(o.value){const c=o.value.contentDocument;if(!c)return;const[d,k]=u(),[P,O]=r();c.open(),c.write(a),c.head.appendChild(d),c.head.appendChild(P),c.body.appendChild(k),c.body.appendChild(O),c.close(),o.value.onload=()=>{const T=c.body.scrollHeight;o.value&&(o.value.style.height=`${T}px`)}}},l=()=>{if(o.value){const s=o.value.contentDocument;if(!s)return;const a=s.body.offsetHeight;o.value.style.height=`${a}px`}},u=()=>{const s=document.createElement("link"),a=document.createElement("script"),c=b("style"),d=b("script");return s.rel="stylesheet",s.href=c,a.src=d,a.async=!0,[s,a]},r=()=>{const s=document.createElement("link"),a=document.createElement("script"),c=_("style"),d=_("script");return s.rel="stylesheet",s.href=c,a.src=d,a.async=!0,[s,a]};return U(()=>{i(y(n.component,n.component.content)),n.html||e.subscribe(n.component,s=>{i(s).then(()=>l())})}),(s,a)=>(p(),m("div",A,[v("iframe",{class:"w-full",ref_key:"iframe",ref:o,sandbox:"allow-scripts allow-same-origin"},null,512),G]))}}),K={class:"relative group"},Q={class:"invisible group-hover:visible"},W={key:1,class:"absolute top-full mt-4 z-10 border shadow-lg rounded-lg border-blue-300"},X={class:"bg-white p-2 text-center"},Y={key:0,class:"text-center text-gray-500"},Z=C({__name:"ComponentFloatingPreview",props:{component:{type:Object,required:!0},position:{type:String,default:"left"}},setup(t){const{component:e}=t,n=h(null),o=h(!1),i=async()=>{if(!(!e.id||n.value||o.value))try{const l=await w(e.id,y(e,e.content));n.value=l.data}catch{o.value=!0}};return(l,u)=>{const r=V("fa-icon");return p(),m("div",K,[v("div",{class:"h-full w-full",onMouseenter:i},[B(l.$slots,"default",{},void 0,!0)],32),v("div",Q,[n.value&&!o.value?(p(),m("div",{key:0,class:E(`absolute preview-${t.position} border-4 shadow-xl rounded-2xl overflow-hidden border-blue-300 bg-white top-full mt-4 scale-[0.2] z-10`)},[z(J,{class:"w-[1366px] h-[768px]",component:t.component,html:n.value},null,8,["component","html"])],2)):(p(),m("div",W,[v("div",X,[o.value?(p(),m("p",Y,D(l.$t("components.labels.noPreview")),1)):(p(),F(r,{key:1,icon:"spinner",class:"animate-spin text-center text-gray-500"}))])]))])])}}});const se=H(Z,[["__scopeId","data-v-4db38fde"]]);export{se as C,J as _,N as u};
